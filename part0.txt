
<!DOCTYPE html>
<html lang="pt-br">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Painel de Vendas - PRIME DISTRIBUIÃ‡ÃƒO</title>
    <link rel="icon" type="image/jpeg" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSnaaZ2WnZBJIxPRfabS4Ug78PKK6Gu3nbHlw&s">
    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
    .flex-center-overlay {
        position: fixed;
        top: 0; right: 0; bottom: 0; left: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    :root {
        --bg-main: #0d1126;
        --bg-card: #1d2347;
        --bg-header: #1e2a5a;
        --text-primary: #cbd5e1; /* slate-300 */
        --text-heading: #ffffff;
        --border-color: #334155; /* slate-700 */
    }

    html.light {
        --bg-main: #f1f5f9; /* slate-100 */
        --bg-card: #ffffff;
        --bg-header: #3b82f6; /* blue-500 */
        --text-primary: #1e293b; /* slate-800 */
        --text-heading: #0f172a; /* slate-900 */
        --border-color: #cbd5e1; /* slate-300 */
    }

    body { background-color: var(--bg-main); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
    .kpi-card, .bg-\[\#1d2347\] { background-color: var(--bg-card) !important; border-color: var(--border-color) !important; }
    .bg-\[\#0d1126\] { background-color: var(--bg-main) !important; }
    header.bg-gradient-to-r { background: var(--bg-header) !important; }

    /* Light Mode Specific Overrides for Text */
    html.light .text-white { color: var(--text-heading) !important; }
    html.light .text-slate-300 { color: var(--text-primary) !important; }
    html.light .text-slate-400 { color: #64748b !important; } /* slate-500 */

    /* Light Mode Overrides for Specific Dark Backgrounds */
    html.light .bg-\[\#0f172a\] { background-color: #f1f5f9 !important; } /* Light gray instead of very dark blue */
    html.light .bg-\[\#151c36\] { background-color: #ffffff !important; } /* White instead of dark table body */
    html.light .bg-\[\#161e3d\] { background-color: #f8fafc !important; } /* Very light gray instead of dark container */

    html.light .bg-slate-700 { background-color: #e2e8f0 !important; color: #1e293b !important; border-color: #cbd5e1 !important; }
    html.light .bg-slate-800 { background-color: #f1f5f9 !important; color: #1e293b !important; border-color: #cbd5e1 !important; }

    /* Ensure Inputs inside filters (often slate-700) are readable */
    html.light input.bg-slate-700, html.light select.bg-slate-700, html.light button.bg-slate-700 {
        background-color: #ffffff !important;
        color: #1e293b !important;
        border: 1px solid #cbd5e1 !important;
    }

    /* Goal Cards - Light Mode Variants */
    html.light .bg-\[\#1e2a5a\] { background-color: #dbeafe !important; border-color: #bfdbfe !important; } /* blue-100 */
    html.light .bg-\[\#3c2a21\] { background-color: #ffedd5 !important; border-color: #fed7aa !important; } /* orange-100 */
    html.light .bg-\[\#3b0764\] { background-color: #f3e8ff !important; border-color: #e9d5ff !important; } /* purple-100 */
    html.light .bg-\[\#064e3b\] { background-color: #d1fae5 !important; border-color: #a7f3d0 !important; } /* emerald-100 */
    html.light .bg-\[\#713f12\] { background-color: #fef9c3 !important; border-color: #fde047 !important; } /* yellow-100 */

    /* Ensure text within these cards is readable in light mode */
    /* Note: .text-white is already overridden to dark in light mode, so dark text on light bg works. */
    /* However, some labels inside cards use specific colors like text-blue-300. We might need to darken them. */
    html.light .text-blue-300 { color: #1d4ed8 !important; } /* blue-700 */
    html.light .text-orange-300 { color: #c2410c !important; } /* orange-700 */
    html.light .text-purple-300 { color: #7e22ce !important; } /* purple-700 */
    html.light .text-emerald-300 { color: #047857 !important; } /* emerald-700 */
    html.light .text-yellow-300 { color: #b45309 !important; } /* amber-700 */

    /* Also handle the inner input background in cards which is bg-[#0f172a] */
    /* This is already handled by the generic override above */

    /* Theme Toggle Switch */
    .theme-switch-wrapper { display: flex; align-items: center; margin-top: auto; padding: 1rem; border-top: 1px solid var(--border-color); }
    .theme-switch { display: inline-block; height: 24px; position: relative; width: 48px; margin-right: 10px; }
    .theme-switch input { display: none; }
    .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 34px; }
    .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; border-radius: 50%; }
    input:checked + .slider { background-color: #38b2ac; }
    input:checked + .slider:before { transform: translateX(24px); }


                            /* Estilo base do tema escuro */
                            body { font-family: 'Inter', sans-serif; background-color: #0d1126; }

                            /* Scrollbars personalizadas para o tema escuro */
                            ::-webkit-scrollbar { width: 8px; }
                            ::-webkit-scrollbar-track { background: #161e3d; } /* Cor de fundo da trilha */
                            ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; } /* Cor do "polegar" */
                            ::-webkit-scrollbar-corner { background: #161e3d; }

                            /* CabeÃ§alhos de tabela fixos (sticky) */
                            .sticky-header th {
                                position: sticky;
                                top: 0;
                                z-index: 10;
                                background-color: #161e3d; /* Cor de fundo escura para o cabeÃ§alho */
                                border-bottom: 2px solid #2d3748; /* Borda escura */
                            }
                            .hidden { display: none; }

                            /* Estilo de botÃµes ativos (filtros, toggles) */
                            .metric-btn.active, .monthly-metric-btn.active, .fornecedor-btn.active, .comparison-toggle-btn.active, .group-btn.active, #main-rede-group-container > div > button.active, #city-rede-group-container > div > button.active, #comparison-rede-group-container > div > button.active, #stock-rede-group-container > div > button.active {
                                background-color: #38b2ac; /* teal-500 */
                                color: #FFF;
                            }

                            /* Overlay do modal */
                            .modal-overlay {
                                position: fixed;
                                top: 0; left: 0; right: 0; bottom: 0;
                                background: rgba(0,0,0,0.7); /* Overlay mais escuro */
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                z-index: 1000;
                            }

                            /* Tooltip */
                            .tooltip { position: relative; display: inline-block; cursor: pointer; }
                            .tooltip .tooltip-text {
                                visibility: hidden;
                                width: auto;
                                min-width: 80px;
                                background-color: #1f2937; /* bg-gray-800 */
                                color: #fff;
                                text-align: center;
                                border-radius: 6px;
                                padding: 5px 8px;
                                position: absolute;
                                z-index: 1001;
                                bottom: 125%;
                                left: 50%;
                                transform: translateX(-50%);
                                opacity: 0;
                                transition: opacity 0.3s;
                                pointer-events: none;
                                white-space: nowrap;
                            }
                            .tooltip:hover .tooltip-text { visibility: visible; opacity: 1; }

                            /* Scrollbar customizada para elementos internos */
                            .custom-scrollbar::-webkit-scrollbar { width: 8px; }
                            .custom-scrollbar::-webkit-scrollbar-track { background: #161e3d; }
                            .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #4a5568; border-radius: 10px; }

                            /* Estilo dos cartÃµes KPI */
                            .kpi-card {
                                background-color: #1d2347; /* Fundo do cartÃ£o */
                                border-radius: 0.5rem;
                                padding: 1.5rem;
                                text-align: center;
                                border: 1px solid #2d3748; /* Borda (slate-700) */
                                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                            }

                            /* Autofill styles to prevent white background in dark mode */
                            input:-webkit-autofill,
                            input:-webkit-autofill:hover,
                            input:-webkit-autofill:focus,
                            input:-webkit-autofill:active {
                                -webkit-box-shadow: 0 0 0 30px #334155 inset !important; /* bg-slate-700 */
                                -webkit-text-fill-color: white !important;
                                transition: background-color 5000s ease-in-out 0s;
                            }

                            html.light input:-webkit-autofill,
                            html.light input:-webkit-autofill:hover,
                            html.light input:-webkit-autofill:focus,
                            html.light input:-webkit-autofill:active {
                                -webkit-box-shadow: 0 0 0 30px #ffffff inset !important;
                                -webkit-text-fill-color: #0f172a !important;
                            }

                            /* BotÃ£o de tendÃªncia de estoque ativo */
        .stock-trend-btn.active, .coverage-trend-btn.active {
                                outline: 2px solid #38b2ac; /* Destaque teal-500 */
                                outline-offset: 2px;
                                transform: scale(1.1);
                            }

                            /* Remove setas de input[type=number] */
                            input[type=number]::-webkit-inner-spin-button,
                            input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
                            input[type=number] { -moz-appearance: textfield; }

    /* Additional Styles for Gatekeeper & Modal */
    #loader { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: #0d1126; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.3s ease-out; }
    #loader-spinner { border: 4px solid #1d2347; border-top: 4px solid #38b2ac; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .hidden { display: none !important; }

    /* Gatekeeper Styles */
    .gatekeeper-card { font-family: 'Inter', sans-serif; padding: 2.5rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5); max-width: 400px; width: 90%; background: #1d2347; text-align: center; border: 1px solid #2d3748; color: #fff; }
    .gatekeeper-btn { display: flex; align-items: center; justify-content: center; gap: 0.75rem; background-color: #2d3748; color: #fff; border: 1px solid #4a5568; padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease; width: 100%; margin-top: 1rem; }
    .gatekeeper-btn:hover { background-color: #4a5568; }

    /* Modal Uploader Styles */
    .bg-modal-content {
        background-color: #1d2347 !important;
        max-height: 90vh;
        overflow-y: auto;
    }
    .bg-modal-content::-webkit-scrollbar { width: 8px; }
    .bg-modal-content::-webkit-scrollbar-track { background: #161e3d; }
    .bg-modal-content::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; }

                            /* KPI Glow Effects */
                            .kpi-glow-base {
                                border: 1px solid transparent !important; /* Override default border */
                                background-origin: border-box;
                                background-clip: padding-box, border-box;
                                position: relative;
                            }

                            .kpi-glow-blue {
                                background-image: linear-gradient(var(--card-bg, #1d2347), var(--card-bg, #1d2347)), linear-gradient(135deg, #3b82f6, #06b6d4); /* Blue to Cyan */
                                box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
                            }

                            .kpi-glow-green {
                                background-image: linear-gradient(var(--card-bg, #1d2347), var(--card-bg, #1d2347)), linear-gradient(135deg, #22c55e, #10b981); /* Green to Emerald */
                                box-shadow: 0 0 15px rgba(34, 197, 94, 0.4);
                            }

                            .kpi-glow-yellow {
                                background-image: linear-gradient(var(--card-bg, #1d2347), var(--card-bg, #1d2347)), linear-gradient(135deg, #eab308, #f59e0b); /* Yellow to Amber */
                                box-shadow: 0 0 15px rgba(234, 179, 8, 0.4);
                            }

                            .kpi-glow-purple {
                                background-image: linear-gradient(var(--card-bg, #1d2347), var(--card-bg, #1d2347)), linear-gradient(135deg, #a855f7, #ec4899); /* Purple to Pink */
                                box-shadow: 0 0 15px rgba(168, 85, 247, 0.4);
                            }
    </style>

</head>
<body class="bg-[#0d1126] text-slate-300 antialiased">

<!-- Tela de Login -->
<div id="tela-login" class="flex-center-overlay z-[2000] hidden" style="background-color: #0d1126;">
    <div class="gatekeeper-card">
        <img src="https://i.imgur.com/Xv8Tb6d.png" alt="Logo" style="width: 80px; height: 80px; margin: 0 auto 1.5rem; border-radius: 50%;">
        <h1 style="margin-top: 0; font-size: 1.8rem; font-weight: 700;">Acesso Restrito</h1>
        <p style="color: #a0aec0; line-height: 1.6;">Este Ã© um sistema privado.</p>
        <button id="login-button" class="gatekeeper-btn">
            <span>Entrar com Google</span>
        </button>
    </div>
</div>

<!-- Tela de Loading -->
<div id="tela-loading" class="flex-center-overlay z-[2000] hidden" style="background-color: #0d1126;">
   <div class="gatekeeper-card" id="loading-card-content">
        <h2 style="margin-top: 0; font-size: 1.5rem; font-weight: 600;">Carregando...</h2>
        <p style="color: #a0aec0;">Verificando credenciais.</p>
        <p style="color: #4a5568; font-size: 0.75rem; margin-top: 1rem;">v5.2.1</p>
    </div>
</div>

<!-- Tela Pendente -->
<div id="tela-pendente" class="flex-center-overlay z-[2000] hidden" style="background-color: #0d1126;">
    <div class="gatekeeper-card">
        <h2 style="margin-top: 0; font-size: 1.5rem; font-weight: 600;">Aguardando AprovaÃ§Ã£o</h2>
        <p style="color: #a0aec0;">Seu acesso estÃ¡ pendente.</p>
        <button id="logout-button-pendente" class="gatekeeper-btn" style="background-color: #dc3545; border-color: #dc3545;">Sair</button>
    </div>
</div>

<!-- Loader Geral -->
<div id="loader" class="hidden">
    <div id="loader-spinner"></div>
    <p id="loader-text" class="text-slate-300 mt-4">Carregando dados...</p>
</div>

<div id="admin-uploader-modal" class="modal-overlay hidden">
        <div class="bg-modal-content rounded-lg shadow-2xl max-w-lg w-full m-4 border border-primary relative text-center p-8">
            <button id="admin-modal-close-btn" class="absolute top-2 right-4 text-3xl font-bold hover:text-red-500 transition-colors">&times;</button>

            <h1 class="text-2xl font-bold mb-4">Uploader (v5.1 - Parcial)</h1>
            <p class="mb-6">Carregue os arquivos para enviar os dados ao Supabase. VocÃª pode carregar um ou mais arquivos de cada vez.</p>

            <div class="space-y-4 mb-6 text-left">
                <div>
                    <label for="supabase-url" class="block text-sm font-medium mb-2">URL do Projeto Supabase</label>
                    <input type="text" id="supabase-url" placeholder="https://[seu-id].supabase.co" autocomplete="new-password" class="w-full text-sm p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-slate-700 border-slate-600 text-white" value="https://dhozwhfmrwiumwpcqabi.supabase.co">
                </div>
                <div>
                    <label for="supabase-key" class="block text-sm font-medium mb-2">Chave Secreta (service_role) ðŸ¤«</label>
                    <input type="password" id="supabase-key" placeholder="Cole sua chave secreta aqui..." autocomplete="new-password" class="w-full text-sm p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 bg-slate-700 border-slate-600 text-white">
                    <p class="text-xs mt-1">Esta chave NUNCA Ã© salva. VocÃª deve digitÃ¡-la toda vez que for usar.</p>
                </div>
            </div>

            <div class="space-y-4 mb-6 border-t border-primary pt-6 text-left">
                <div>
                    <label for="sales-file-input" class="block text-sm font-medium mb-2">1. Arquivo de Vendas (MÃªs Atual)</label>
                    <input type="file" id="sales-file-input" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-button file:text-secondary hover:file:bg-button-hover" accept=".csv, .xls, .xlsx"/>
                </div>
                <div>
                    <label for="clients-file-input" class="block text-sm font-medium mb-2">2. Cadastro de Clientes</label>
                    <input type="file" id="clients-file-input" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-button file:text-secondary hover:file:bg-button-hover" accept=".csv, .xls, .xlsx"/>
                </div>
                <div>
                    <label for="products-file-input" class="block text-sm font-medium mb-2">3. Cadastro de Produtos</label>
                    <input type="file" id="products-file-input" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-button file:text-secondary hover:file:bg-button-hover" accept=".csv, .xls, .xlsx"/>
                </div>
                <div>
                    <label for="history-file-input" class="block text-sm font-medium mb-2">4. HistÃ³rico de Vendas (Trimestre Anterior)</label>
                    <input type="file" id="history-file-input" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-button file:text-secondary hover:file:bg-button-hover" accept=".csv, .xls, .xlsx"/>
                </div>
                 <div>
                    <label for="innovations-file-input" class="block text-sm font-medium mb-2">5. Planilha de InovaÃ§Ãµes (MÃªs)</label>
                    <input type="file" id="innovations-file-input" class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-button file:text-secondary hover:file:bg-button-hover" accept=".csv, .xls, .xlsx"/>
                </div>
            </div>

            <button id="generate-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg w-full disabled:bg-slate-500 disabled:hover:bg-slate-500 disabled:cursor-not-allowed">
                Enviar Dados para o Supabase
            </button>

            <div id="status-container" class="hidden mt-6 text-sm h-12 flex flex-col justify-center">
                <p id="status-text" class="mb-2"></p>
                <div class="w-full h-2 rounded-lg overflow-hidden bg-slate-700">
                    <div id="progress-bar" class="bg-teal-500 h-full transition-all duration-300"></div>
                </div>
            </div>
        </div>
    </div>


<div id="content-wrapper" class="hidden min-h-screen transition-all duration-300">

                        <aside id="side-menu" class="fixed top-0 left-0 z-50 w-64 h-screen transition-transform -translate-x-full bg-[#1d2347] border-r border-slate-700 flex flex-col">
                            <div class="flex items-center justify-between p-4 border-b border-slate-700">
                                <span class="text-xl font-bold text-white">Menu</span>
                                <button id="close-sidebar-btn" class="text-slate-400 hover:text-white">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                            </div>
                            <div class="flex-1 overflow-y-auto custom-scrollbar py-4 px-3">
                                <ul class="space-y-2 font-medium">
                                    <li>
                                        <button data-target="dashboard" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                                            <span class="ml-3">Dashboard</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="pedidos" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                                            <span class="ml-3">Pedidos</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="comparativo" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                                            <span class="ml-3">Comparativo</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="estoque" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg>
                                            <span class="ml-3">Estoque</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="cobertura" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                                            <span class="ml-3">Cobertura</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="cidades" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                                            <span class="ml-3">Cidades</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="semanal" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                            <span class="ml-3">Semanal</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="inovacoes-mes" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                            <span class="ml-3">InovaÃ§Ãµes</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="mix" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                                            <span class="ml-3">Mix Salty & Foods</span>
                                        </button>
                                    </li>
                                    <li>
                                        <button data-target="goals" class="nav-link flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 100-18 9 9 0 000 18z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15a3 3 0 100-6 3 3 0 000 6z"></path>
                                            </svg>
                                            <span class="ml-3">Metas</span>
                                        </button>
                                    </li>


                                    <li>
                                        <button id="open-admin-btn" class="flex items-center p-2 text-slate-300 rounded-lg hover:bg-slate-700 group w-full text-left">
                                            <svg class="w-5 h-5 text-slate-400 transition duration-75 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                                            <span class="ml-3">Admin / Upload</span>
                                        </button>
                                    </li>
</ul>
                            <div class="theme-switch-wrapper">
                                <label class="theme-switch" for="checkbox-theme">
                                    <input type="checkbox" id="checkbox-theme" />
                                    <div class="slider round"></div>
                                </label>
                                <span class="text-sm font-medium">Modo Luz</span>
                            </div>

                            </div>
                        </aside>
                        <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-40 hidden glass-effect"></div>

                        <div id="page-transition-loader" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-[9999] flex items-center justify-center transition-opacity duration-300">
                            <div class="flex flex-col items-center">
                                <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span id="loader-text" class="text-white text-lg mt-4">Processando dados...</span>
                            </div>
                        </div>

                        <div id="content-wrapper" class="min-h-screen transition-all duration-300">
                            <div id="main-dashboard">
                                <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                                    <!-- CabeÃ§alho com gradiente escuro -->
                                    <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                        <div class="flex items-center gap-4">
                                            <button class="sidebar-toggle text-white focus:outline-none">
                                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                            </button>
                                            <div class="flex-1 flex flex-col sm:flex-row justify-between items-start gap-4">
                                                <div class="text-center sm:text-left">
                                                    <h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1>
                                                    <p id="last-update-text" class="text-slate-300 mt-1">Dados atualizados em: ${generationDate}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </header>

                                <!-- KPIs com bordas e cores atualizadas -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                                    <div class="kpi-card kpi-glow-base kpi-glow-blue transition transform hover:-translate-y-1 duration-200">
                                        <h3 class="text-slate-400 font-medium uppercase text-sm">Volume Kg</h3>
                                        <p id="total-peso" class="text-4xl font-bold text-white my-2">0,0</p>
                                    </div>
                                    <div class="kpi-card kpi-glow-base kpi-glow-green transition transform hover:-translate-y-1 duration-200">
                                        <h3 class="text-slate-400 font-medium uppercase text-sm">Faturamento R$</h3>
                                        <p id="total-vendas" class="text-4xl font-bold text-white my-2">R$ 0,00</p>
                                    </div>
                                    <div class="kpi-card kpi-glow-base kpi-glow-yellow transition transform hover:-translate-y-1 duration-200">
                                        <h3 class="text-slate-400 font-medium uppercase text-sm">SKU/PDV</h3>
                                        <p id="kpi-sku-pdv" class="text-4xl font-bold text-white my-2">0,0</p>
                                    </div>
                                    <div class="kpi-card kpi-glow-base kpi-glow-purple transition transform hover:-translate-y-1 duration-200">
                                        <h3 class="text-slate-400 font-medium uppercase text-sm">Cobertura PDVs</h3>
                                        <p id="kpi-positivacao" class="text-4xl font-bold text-white my-2">0,0%</p>
                                        <p id="kpi-positivacao-percent" class="text-sm text-slate-400 -mt-1">0 PDVs</p>
                                    </div>
                                </div>

                                <div class="mb-6 flex flex-col sm:flex-row justify-between items-center gap-4">
                                    <!-- BotÃµes de Categoria (Pepsico/Multimarcas) -->
                                    <div id="fornecedor-toggle-container" class="w-full sm:w-auto rounded-lg p-1 flex justify-center sm:justify-start gap-2">
                                        <button data-fornecedor="PEPSICO" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1 sm:flex-none">PEPSICO</button>
                                        <button data-fornecedor="MULTIMARCAS" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1 sm:flex-none">MULTIMARCAS</button>
                                    </div>
                                    <!-- BotÃµes de NavegaÃ§Ã£o removidos (movidos para sidebar) -->
                                </div>

                                <!-- Container de Filtros -->
                                <div id="main-filters" class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                    <div class="flex flex-wrap gap-4 items-end">
                                        <!-- Filtro de Rede -->
                                        <div id="main-rede-filter-wrapper" class="relative flex-1 min-w-[200px]">
                                            <label class="block mb-2 text-sm font-medium text-slate-400">Rede</label>
                                            <div id="main-rede-group-container" class="inline-flex rounded-md shadow-sm w-full" role="group">
                                                <button type="button" data-group="" class="group-btn active py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-l-lg hover:bg-slate-600 flex-1">Todos</button>
                                                <button type="button" data-group="com_rede" id="main-com-rede-btn" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border-t border-b border-slate-600 hover:bg-slate-600 flex items-center justify-center gap-2 flex-1">
                                                    <span id="main-com-rede-btn-text">Com Rede</span>
                                                    <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                                </button>
                                                <button type="button" data-group="sem_rede" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-r-lg hover:bg-slate-600 flex-1">Sem Rede</button>
                                            </div>
                                            <div id="main-rede-filter-dropdown" class="hidden absolute z-20 w-full mt-1 top-full left-0 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-left text-white"></div>
                                        </div>
                                        <!-- Outros Filtros -->
                                         <div class="relative flex-1 min-w-[200px]">
                                            <label for="supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                            <button id="supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="supervisor-filter-text">Todos</span>
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="supervisor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                         </div>
                                        <div class="relative flex-1 min-w-[200px]"><label for="vendedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label><button id="vendedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="vendedor-filter-text">Todos Vendedores</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button><div id="vendedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                        <div class="relative flex-1 min-w-[200px]"><label for="tipo-venda-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Tipo Venda</label><button id="tipo-venda-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="tipo-venda-filter-text">Todos os Tipos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="tipo-venda-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                         <div class="relative flex-1 min-w-[200px]">
                                            <label for="fornecedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Fornecedor</label>
                                            <button id="fornecedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="fornecedor-filter-text">Todos</span>
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="fornecedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                         </div>
                                        <div class="flex-1 min-w-[200px]"><label for="codcli-filter" class="block mb-2 text-sm font-medium text-slate-400">CÃ³d. Cliente</label><input type="text" id="codcli-filter" placeholder="Digite o cÃ³digo..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5"></div>
                                        <div class="flex-1 min-w-[200px]"><label for="posicao-filter" class="block mb-2 text-sm font-medium text-slate-400">PosiÃ§Ã£o</label><select id="posicao-filter" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5"><option value="">Todas</option><option value="L">Liberado</option><option value="M">Montado</option><option value="F">Faturado</option></select></div>
                                        <div class="flex-1 min-w-[200px]"><button id="clear-filters-btn" class="w-full bg-slate-600 hover:bg-slate-500 text-white font-bold py-2.5 px-4 rounded-lg">Limpar Filtros</button></div>
                                    </div>
                                </div>
                                <main id="app-container">
                                    <div id="chartView" class="">
                                        <!-- GrÃ¡fico de TendÃªncia -->
                                        <div class="mb-6 bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                            <div class="flex justify-between items-center mb-4">
                                                <div class="w-1/3">
                                                    <label for="main-holiday-picker-btn" class="block mb-2 text-sm font-medium text-slate-400">Feriados do MÃªs</label>
                                                    <button id="main-holiday-picker-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left focus:outline-none focus:ring-2 focus:ring-teal-500">Selecionar Feriados</button>
                                                </div>
                                                <div class="w-1/3 text-center">
                                                    <h2 class="text-lg font-semibold text-white">TendÃªncia de Faturamento</h2>
                                                </div>
                                                <div class="w-1/3"></div>
                                            </div>
                                            <div id="trendChartContainer" class="relative h-80"></div>
                                        </div>
                                        <!-- GrÃ¡ficos menores -->
                                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                            <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm"><h2 id="sales-by-person-title" class="text-lg font-semibold text-white mb-4 text-center">Vendas por Supervisor</h2><div id="salesByPersonChartContainer" class="relative h-80"></div></div>
                                            <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm"><h2 id="faturamentoPorFornecedorTitle" class="text-lg font-semibold text-white mb-4 text-center">Faturamento por Categoria</h2><div id="faturamentoPorFornecedorChartContainer" class="relative h-80"></div></div>
                                        </div>
                                        <!-- GrÃ¡fico de Produtos -->
                                        <div class="mt-6 bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                            <div class="flex justify-between items-center mb-4"><h2 class="text-lg font-semibold text-white">Vendas por Produto</h2>
                                                <div class="bg-slate-700 rounded-lg p-1 flex">
                                                    <button id="faturamentoBtn" class="metric-btn active px-3 py-1 text-sm rounded-md text-white">Faturamento</button>
                                                    <button id="pesoBtn" class="metric-btn px-3 py-1 text-sm rounded-md text-slate-300">Peso Kg</button>
                                                </div>
                                            </div>
                                            <div id="salesByProductBarChartContainer" class="relative h-80"></div>
                                        </div>
                                    </div>
                                    <!-- VisÃ£o de Tabela (Pedidos) -->
                                    <div id="tableView" class="hidden">
                                        <div class="overflow-x-auto bg-[#1d2347] rounded-lg border border-slate-700 shadow-sm" style="max-height: 60vh;">
                                            <table class="min-w-full text-sm text-left text-slate-300">
                                                <thead class="text-xs text-slate-400 uppercase sticky-header"> <!-- Sticky header jÃ¡ estilizado no <style>
    :root {
        --bg-main: #0d1126;
        --bg-card: #1d2347;
        --bg-header: #1e2a5a;
        --text-primary: #cbd5e1; /* slate-300 */
        --text-heading: #ffffff;
        --border-color: #334155; /* slate-700 */
    }

    html.light {
        --bg-main: #f1f5f9; /* slate-100 */
        --bg-card: #ffffff;
        --bg-header: #3b82f6; /* blue-500 */
        --text-primary: #1e293b; /* slate-800 */
        --text-heading: #0f172a; /* slate-900 */
        --border-color: #cbd5e1; /* slate-300 */
    }

    body { background-color: var(--bg-main); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
    .kpi-card, .bg-\[\#1d2347\] { background-color: var(--bg-card) !important; border-color: var(--border-color) !important; }
    .bg-\[\#0d1126\] { background-color: var(--bg-main) !important; }
    header.bg-gradient-to-r { background: var(--bg-header) !important; }

    /* Light Mode Specific Overrides for Text */
    html.light .text-white { color: var(--text-heading) !important; }
    html.light .text-slate-300 { color: var(--text-primary) !important; }
    html.light .text-slate-400 { color: #64748b !important; } /* slate-500 */

    /* Theme Toggle Switch */
    .theme-switch-wrapper { display: flex; align-items: center; margin-top: auto; padding: 1rem; border-top: 1px solid var(--border-color); }
    .theme-switch { display: inline-block; height: 24px; position: relative; width: 48px; margin-right: 10px; }
    .theme-switch input { display: none; }
    .slider { background-color: #ccc; bottom: 0; cursor: pointer; left: 0; position: absolute; right: 0; top: 0; transition: .4s; border-radius: 34px; }
    .slider:before { background-color: #fff; bottom: 4px; content: ""; height: 16px; left: 4px; position: absolute; transition: .4s; width: 16px; border-radius: 50%; }
    input:checked + .slider { background-color: #38b2ac; }
    input:checked + .slider:before { transform: translateX(24px); }
 -->
                                                    <tr><th class="px-4 py-3">NÂº Pedido</th><th class="px-4 py-3">CÃ³d. Cliente</th><th class="px-4 py-3">Vendedor</th><th class="px-4 py-3">Fornecedor</th><th class="px-4 py-3">Data Pedido</th><th class="px-4 py-3">Data Fat.</th><th class="px-4 py-3 text-right">Peso Total</th><th class="px-4 py-3 text-right">Faturamento Total</th><th class="px-4 py-3 text-center">PosiÃ§Ã£o</th></tr>
                                                </thead>
                                                <tbody id="report-table-body" class="divide-y divide-slate-700"></tbody>
                                            </table>
                                        </div>
                                        <!-- PaginaÃ§Ã£o da Tabela -->
                                        <div id="table-pagination-controls" class="hidden mt-4 flex justify-between items-center">
                                            <button id="prev-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50" disabled>Anterior</button>
                                            <span id="page-info-text" class="text-slate-400">PÃ¡gina 1 de 1</span>
                                            <button id="next-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50" disabled>PrÃ³xima</button>
                                        </div>
                                    </div>
                                </main>
                            </div>
                        </div>

                        <!-- EcrÃ£ de Cidades -->
                        <div id="city-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                            <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex items-center gap-4">
                                    <button class="sidebar-toggle text-white focus:outline-none">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    </button>
                                    <div><h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1><p class="text-lg text-slate-300 -mt-1">AnÃ¡lise de Vendas por Cidade</p></div>
                                </div>
                            </header>
                            <div id="city-view-content">
                                <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                    <div class="flex flex-wrap gap-4 items-end">
                                        <!-- Filtro de Rede (Cidades) -->
                                        <div id="city-rede-filter-wrapper" class="relative flex-1 min-w-[200px]">
                                            <label class="block mb-2 text-sm font-medium text-slate-400">Rede</label>
                                            <div id="city-rede-group-container" class="inline-flex rounded-md shadow-sm w-full" role="group">
                                                <button type="button" data-group="" class="group-btn active py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-l-lg hover:bg-slate-600 flex-1">Todos</button>
                                                <div class="relative flex-1">
                                                    <button type="button" data-group="com_rede" id="city-com-rede-btn" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border-t border-b border-slate-600 hover:bg-slate-600 flex items-center justify-center gap-2 w-full">
                                                        <span id="city-com-rede-btn-text">Com Rede</span>
                                                        <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                                    </button>
                                                    <div id="city-rede-filter-dropdown" class="hidden absolute z-20 w-full mt-1 top-full left-0 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-left text-white"></div>
                                                </div>
                                                <button type="button" data-group="sem_rede" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-r-lg hover:bg-slate-600 flex-1">Sem Rede</button>
                                            </div>
                                        </div>
                                        <!-- Outros Filtros (Cidades) -->
                                        <div class="relative flex-1 min-w-[200px]">
                                            <label for="city-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                            <button id="city-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="city-supervisor-filter-text">Todos</span>
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="city-supervisor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                        <div class="relative flex-1 min-w-[200px]"><label for="city-vendedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label><button id="city-vendedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="city-vendedor-filter-text">Todos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="city-vendedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                        <div class="relative flex-1 min-w-[200px]"><label for="city-name-filter" class="block mb-2 text-sm font-medium text-slate-400">Cidade</label><input type="text" id="city-name-filter" placeholder="Digite a cidade..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5" autocomplete="off"><div id="city-suggestions" class="absolute z-10 w-full bg-slate-800 border border-slate-600 rounded-lg mt-1 hidden max-h-48 overflow-y-auto custom-scrollbar text-white"></div></div>
                                        <div class="flex-1 min-w-[200px]"><label for="city-codcli-filter" class="block mb-2 text-sm font-medium text-slate-400">CÃ³d. Cliente</label><input type="text" id="city-codcli-filter" placeholder="Digite o cÃ³digo..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5"></div>
                                        <div class="relative flex-1 min-w-[200px]">
                                            <label for="city-tipo-venda-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Tipo Venda</label>
                                            <button id="city-tipo-venda-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="city-tipo-venda-filter-text">Todos os Tipos</span>
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="city-tipo-venda-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                    </div>
                                    <div class="mt-4 flex justify-center">
                                        <button id="clear-city-filters-btn" class="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded-lg">Limpar Filtros</button>
                                    </div>
                                </div>
                                <!-- GrÃ¡ficos (Cidades) -->
                                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                                    <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                        <div class="flex justify-between items-center mb-4">
                                            <div class="w-1/4"><span class="text-xl font-bold text-indigo-400">Top 10</span></div>
                                            <div class="w-1/2 text-center"><h2 id="city-chart-title" class="text-lg font-semibold text-white"></h2></div>
                                            <div class="w-1/4 text-right"><p class="text-slate-400 text-sm">Total Vendido</p><p id="total-faturamento-cidade" class="text-xl font-bold text-green-400">R$ 0,00</p></div>
                                        </div>
                                        <div id="salesByClientInCityChartContainer" class="relative h-96"></div>
                                    </div>
                                    <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                        <div class="flex justify-between items-center mb-4">
                                            <div class="w-1/4"></div>
                                            <div class="w-1/2 text-center"><h2 class="text-lg font-semibold text-white">Status dos Clientes</h2></div>
                                            <div class="w-1/4 text-right">
                                                <p class="text-slate-400 text-sm">Total Clientes</p>
                                                <p id="total-clientes-cidade" class="text-xl font-bold text-teal-400">0</p>
                                            </div>
                                        </div>
                                        <div id="customerStatusChartContainer" class="relative h-96 flex items-center justify-center"></div>
                                    </div>
                                </div>
                                <!-- Tabelas (Cidades) -->
                                <div class="bg-[#1d2347] p-4 rounded-lg mt-6 border border-slate-700 shadow-sm"><div class="flex justify-between items-center mb-4 px-4"><h3 class="text-lg font-semibold text-white">Clientes Ativos no MÃªs</h3><button id="export-active-pdf-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg text-sm">Exportar RelatÃ³rio</button></div><div class="overflow-x-auto custom-scrollbar" style="max-height: 40vh;"><table class="min-w-full text-sm text-left text-slate-300"><thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-4 py-3">CÃ³digo</th><th class="px-4 py-3">Nome Fantasia</th><th class="px-4 py-3 text-right">Faturamento</th><th class="px-4 py-3">Cidade</th><th class="px-4 py-3">Bairro</th><th class="px-4 py-3">RCA 1</th></tr></thead><tbody id="city-active-detail-table-body" class="divide-y divide-slate-700"></tbody></table></div></div>
                                <div class="bg-[#1d2347] p-4 rounded-lg mt-6 border border-slate-700 shadow-sm"><div class="flex justify-between items-center mb-4 px-4"><h3 class="text-lg font-semibold text-white">Clientes S/ Vendas no MÃªs</h3><button id="export-inactive-pdf-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg text-sm">Exportar RelatÃ³rio</button></div><div class="overflow-x-auto custom-scrollbar" style="max-height: 40vh;"><table class="min-w-full text-sm text-left text-slate-300"><thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-4 py-3">CÃ³digo</th><th class="px-4 py-3">Nome Fantasia</th><th class="px-4 py-3">Cidade</th><th class="px-4 py-3">Bairro</th><th class="px-4 py-3 text-center">Ãšltima Compra</th><th class="px-4 py-3">RCA 1</th></tr></thead><tbody id="city-inactive-detail-table-body" class="divide-y divide-slate-700"></tbody></table></div></div>
                            </div>
                        </div>

                        <!-- EcrÃ£ Semanal -->
                        <div id="weekly-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                            <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex items-center gap-4">
                                    <button class="sidebar-toggle text-white focus:outline-none">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    </button>
                                    <div><h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1><p class="text-lg text-slate-300 -mt-1">Acompanhamento Semanal</p></div>
                                </div>
                            </header>
                            <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                                    <div id="weekly-fornecedor-toggle-container" class="w-full sm:w-auto rounded-lg p-1 flex justify-center sm:justify-start gap-2"><button data-fornecedor="PEPSICO" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1 sm:flex-none">PEPSICO</button><button data-fornecedor="MULTIMARCAS" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1 sm:flex-none">MULTIMARCAS</button></div>
                                    <button id="clear-weekly-filters-btn" class="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded-lg">Limpar Filtros</button>
                                </div>
                                <div class="mt-4"><label class="block text-sm font-medium text-slate-400 mb-2">Filtrar Supervisores</label><div id="weekly-supervisor-filter" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 text-slate-300"></div></div>
                            </div>
                            <div class="grid grid-cols-1 gap-6">
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <div class="flex justify-between items-center mb-4"><h2 class="text-lg font-semibold text-white text-center">Faturamento Mensal por Dia da Semana</h2><div class="text-right"><p class="text-slate-400 text-sm">Total do MÃªs</p><p id="total-mes-semanal" class="text-xl font-bold text-green-400">R$ 0,00</p></div></div><div id="weeklySalesChartContainer" class="relative h-96"></div>
                                    <div class="mt-6 border-t border-slate-700 pt-4"><h3 class="text-md font-semibold text-white mb-3 text-center">Resumo de Faturamento Semanal</h3><div class="overflow-x-auto"><table class="min-w-full text-sm text-left text-slate-300"><thead class="text-xs text-slate-400 uppercase"><tr><th class="px-4 py-2 bg-slate-800 rounded-l-lg">Semana</th><th class="px-4 py-2 bg-slate-800 text-right rounded-r-lg">Faturamento Total</th></tr></thead><tbody id="weekly-summary-table-body" class="divide-y divide-slate-700"></tbody></table></div></div>
                                </div>
                                <div class="grid grid-cols-1 gap-6"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm"><h2 class="text-lg font-semibold text-white mb-4 text-center">Ranking de PositivaÃ§Ã£o</h2><div id="positivacaoChartContainer" class="relative h-80"></div></div><div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm"><h2 class="text-lg font-semibold text-white mb-4 text-center">Ranking de Mix de Produtos (Por PDV)</h2><div id="mixChartContainer" class="relative h-80"></div></div></div><div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm"><h2 class="text-lg font-semibold text-white mb-4 text-center">Top 10 Vendedores (Faturamento)</h2><div id="topSellersChartContainer" class="relative h-80"></div></div></div>
                            </div>
                        </div>

                        <!-- EcrÃ£ Comparativo -->
                        <div id="comparison-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                            <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex items-center gap-4">
                                    <button class="sidebar-toggle text-white focus:outline-none">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    </button>
                                    <div><h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1><p class="text-lg text-slate-300 -mt-1">Comparativo entre Meses</p></div>
                                </div>
                            </header>
                            <!-- Filtros (Comparativo) -->
                            <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                <div id="comparison-rede-filter-wrapper" class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-4">
                                    <div class="relative w-full sm:w-1/2">
                                        <label class="block mb-2 text-sm font-medium text-slate-400">Rede</label>
                                        <div id="comparison-rede-group-container" class="inline-flex rounded-md shadow-sm w-full" role="group">
                                            <button type="button" data-group="" class="group-btn active py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-l-lg hover:bg-slate-600 flex-1">Todos</button>
                                            <button type="button" data-group="com_rede" id="comparison-com-rede-btn" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border-t border-b border-slate-600 hover:bg-slate-600 flex items-center justify-center gap-2 flex-1">
                                                <span id="comparison-com-rede-btn-text">Com Rede</span>
                                                <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <button type="button" data-group="sem_rede" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-r-lg hover:bg-slate-600 flex-1">Sem Rede</button>
                                        </div>
                                        <div id="comparison-rede-filter-dropdown" class="hidden absolute z-20 w-full mt-1 top-full left-0 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-left text-white"></div>
                                    </div>
                                    <div class="w-full sm:w-1/2">
                                        <label class="block mb-2 text-sm font-medium text-slate-400">Pasta</label>
                                        <div id="comparison-fornecedor-toggle-container" class="w-full rounded-lg p-1 flex justify-center gap-2">
                                            <button data-fornecedor="PEPSICO" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1">PEPSICO</button>
                                            <button data-fornecedor="MULTIMARCAS" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1">MULTIMARCAS</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                    <div class="relative">
                                        <label for="comparison-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                        <button id="comparison-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="comparison-supervisor-filter-text">Todos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="comparison-supervisor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div class="relative"><label for="comparison-vendedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label><button id="comparison-vendedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="comparison-vendedor-filter-text">Todos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="comparison-vendedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div class="relative"><label for="comparison-supplier-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Fornecedor</label><button id="comparison-supplier-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="comparison-supplier-filter-text">Todos Fornecedores</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="comparison-supplier-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div class="relative"><label for="comparison-city-filter" class="block mb-2 text-sm font-medium text-slate-400">Cidade</label><input type="text" id="comparison-city-filter" placeholder="Digite a cidade..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5" autocomplete="off"><div id="comparison-city-suggestions" class="absolute z-10 w-full bg-slate-800 border border-slate-600 rounded-lg mt-1 hidden max-h-48 overflow-y-auto custom-scrollbar text-white"></div></div>
                                </div>
                                <div class="grid grid-cols-1 mt-4">
                                    <div class="relative">
                                        <label for="comparison-product-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Filtrar por Produto</label>
                                        <button id="comparison-product-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="comparison-product-filter-text">Todos os Produtos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>
                                        <div id="comparison-product-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg">
                                            <div class="p-2 border-b border-slate-700"><input type="text" id="comparison-product-search-input" placeholder="Buscar produto..." class="bg-slate-600 text-xs rounded-lg block w-full p-2 border border-slate-500 placeholder-slate-400 text-white focus:outline-none focus:ring-2 focus:ring-teal-500"></div>
                                            <div id="comparison-product-list" class="max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end border-t border-slate-700 pt-4 mt-4">
                                    <div><label for="comparison-filial-filter" class="block mb-2 text-sm font-medium text-slate-400">Filial</label><select id="comparison-filial-filter" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5"><option value="ambas" selected>Ambas</option><option value="05">Filial 05</option><option value="08">Filial 08</option></select></div>
                                    <div class="relative">
                                        <label for="comparison-tipo-venda-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Tipo Venda</label>
                                        <button id="comparison-tipo-venda-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="comparison-tipo-venda-filter-text">Todos os Tipos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="comparison-tipo-venda-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <button id="comparison-tendency-toggle" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-2.5 px-4 rounded-lg">Calcular TendÃªncia</button>
                                    <div>
                                        <label for="comparison-holiday-picker-btn" class="block mb-2 text-sm font-medium text-slate-400">Feriados do MÃªs</label>
                                        <button id="comparison-holiday-picker-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left focus:outline-none focus:ring-2 focus:ring-teal-500">Selecionar Feriados</button>
                                    </div>
                                    <button id="clear-comparison-filters-btn" class="w-full bg-slate-600 hover:bg-slate-500 text-white font-bold py-2.5 px-4 rounded-lg">Limpar Filtros</button>
                                </div>
                            </div>
                            <!-- KPIs (Comparativo) -->
                            <div id="comparison-kpi-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-6">
                                <!-- KPIs serÃ£o renderizados aqui pelo JS -->
                            </div>
                            <!-- GrÃ¡ficos (Comparativo) -->
                            <div class="grid grid-cols-1 gap-6">
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <div class="flex justify-center items-center mb-4 relative">
                                        <!-- Metric Toggle (Left Side) - Only visible for Monthly View -->
                                        <div id="comparison-monthly-metric-container" class="absolute left-0 top-0 bottom-0 flex items-center hidden">
                                            <div class="flex bg-slate-700 rounded-lg p-1">
                                                <button id="toggle-monthly-fat-btn" class="monthly-metric-btn active px-3 py-1 text-sm rounded-md text-white">Faturamento</button>
                                                <button id="toggle-monthly-clients-btn" class="monthly-metric-btn px-3 py-1 text-sm rounded-md text-slate-300">Clientes</button>
                                            </div>
                                        </div>

                                        <h2 id="comparison-chart-title" class="text-lg font-semibold text-white text-center">Comparativo de Faturamento Semanal</h2>
                                        <div class="absolute right-0 top-0 bottom-0 flex items-center">
                                            <div id="comparison-chart-toggle" class="flex bg-slate-700 rounded-lg p-1">
                                                <button id="toggle-weekly-btn" class="comparison-toggle-btn active px-3 py-1 text-sm rounded-md text-white">Semanal</button>
                                                <button id="toggle-monthly-btn" class="comparison-toggle-btn px-3 py-1 text-sm rounded-md text-slate-300">Mensal</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="weeklyComparisonChartContainer" class="relative h-96"></div>
                                    <div id="monthlyComparisonChartContainer" class="relative h-96 hidden"></div>
                                </div>
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <h2 class="text-lg font-semibold text-white text-center mb-4">Faturamento por Dia da Semana</h2>
                                    <div id="dailyWeeklyComparisonChartContainer" class="relative h-96"></div>
                                </div>
                                <!-- Tabela (Comparativo) -->
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm"><h2 class="text-lg font-semibold text-white text-center mb-4">VariaÃ§Ã£o de Faturamento por Supervisor</h2><div class="overflow-x-auto custom-scrollbar" style="max-height: 40vh;"><table class="min-w-full text-sm text-left text-slate-300"><thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-4 py-3">Supervisor</th><th class="px-4 py-3 text-right">MÃ©dia Trim.</th><th class="px-4 py-3 text-right">Fat. MÃªs Atual</th><th class="px-4 py-3 text-right">VariaÃ§Ã£o</th></tr></thead><tbody id="supervisorComparisonTableBody" class="divide-y divide-slate-700"></tbody></table></div></div>
                            </div>
                        </div>

                        <!-- EcrÃ£ Estoque -->
                        <div id="stock-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                            <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex items-center gap-4">
                                    <button class="sidebar-toggle text-white focus:outline-none">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    </button>
                                    <div><h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1><p class="text-lg text-slate-300 -mt-1">AnÃ¡lise de Estoque</p></div>
                                </div>
                            </header>
                            <!-- Filtros (Estoque) -->
                            <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                <div id="stock-rede-filter-wrapper" class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-4">
                                    <div class="relative w-full sm:w-1/2">
                                        <label class="block mb-2 text-sm font-medium text-slate-400">Rede</label>
                                        <div id="stock-rede-group-container" class="inline-flex rounded-md shadow-sm w-full" role="group">
                                            <button type="button" data-group="" class="group-btn active py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-l-lg hover:bg-slate-600 flex-1">Todos</button>
                                            <button type="button" data-group="com_rede" id="stock-com-rede-btn" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border-t border-b border-slate-600 hover:bg-slate-600 flex items-center justify-center gap-2 flex-1">
                                                <span id="stock-com-rede-btn-text">Com Rede</span>
                                                <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <button type="button" data-group="sem_rede" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-r-lg hover:bg-slate-600 flex-1">Sem Rede</button>
                                        </div>
                                        <div id="stock-rede-filter-dropdown" class="hidden absolute z-20 w-full mt-1 top-full left-0 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-left text-white"></div>
                                    </div>
                                    <div class="w-full sm:w-1/2">
                                        <label class="block mb-2 text-sm font-medium text-slate-400">Pasta</label>
                                        <div id="stock-fornecedor-toggle-container" class="w-full rounded-lg p-1 flex justify-center gap-2">
                                            <button data-fornecedor="PEPSICO" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1">PEPSICO</button>
                                            <button data-fornecedor="MULTIMARCAS" class="fornecedor-btn bg-slate-700 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg flex-1">MULTIMARCAS</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                                    <div class="relative">
                                        <label for="stock-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                        <button id="stock-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="stock-supervisor-filter-text">Todos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="stock-supervisor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div class="relative"><label for="stock-vendedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label><button id="stock-vendedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="stock-vendedor-filter-text">Todos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="stock-vendedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div class="relative"><label for="stock-supplier-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Fornecedor</label><button id="stock-supplier-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="stock-supplier-filter-text">Todos Fornecedores</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="stock-supplier-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div class="relative"><label for="stock-city-filter" class="block mb-2 text-sm font-medium text-slate-400">Cidade</label><input type="text" id="stock-city-filter" placeholder="Digite a cidade..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5" autocomplete="off"><div id="stock-city-suggestions" class="absolute z-10 w-full bg-slate-800 border border-slate-600 rounded-lg mt-1 hidden max-h-48 overflow-y-auto custom-scrollbar text-white"></div></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                                    <div class="lg:col-span-2 relative">
                                        <label for="stock-product-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Produto</label>
                                        <button id="stock-product-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="stock-product-filter-text">Todos os Produtos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>
                                        <div id="stock-product-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg">
                                            <div class="p-2 border-b border-slate-700"><input type="text" id="stock-product-search-input" placeholder="Buscar produto..." class="bg-slate-600 text-xs rounded-lg block w-full p-2 border border-slate-500 placeholder-slate-400 text-white focus:outline-none focus:ring-2 focus:ring-teal-500"></div>
                                            <div id="stock-product-list" class="max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="stock-filial-filter" class="block mb-2 text-sm font-medium text-slate-400">Filial</label>
                                        <select id="stock-filial-filter" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5">
                                            <option value="ambas" selected>Ambas</option>
                                            <option value="05">Filial 05</option>
                                            <option value="08">Filial 08</option>
                                        </select>
                                    </div>
                                    <div class="relative">
                                        <label for="stock-tipo-venda-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Tipo Venda</label>
                                        <button id="stock-tipo-venda-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="stock-tipo-venda-filter-text">Todos os Tipos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="stock-tipo-venda-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <button id="clear-stock-filters-btn" class="w-full bg-slate-600 hover:bg-slate-500 text-white font-bold py-2.5 px-4 rounded-lg">Limpar Filtros</button>
                                </div>
                            </div>
                            <!-- Tabela Principal (Estoque) -->
                             <div class="bg-[#1d2347] p-4 rounded-lg mb-6 border border-slate-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold text-white">AnÃ¡lise de Estoque e TendÃªncia de SaÃ­da</h2>
                                    <div class="flex items-end gap-4">
                                        <div>
                                            <label for="stock-working-days-input" class="block text-xs font-medium text-slate-400 mb-1 text-center">Dias Ãšteis</la bel>
                                            <div class="flex items-center justify-center gap-1">
                                                <input type="number" id="stock-working-days-input" value="0" min="1" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg block w-20 p-1.5 text-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="max-working-days-label" class="text-xs text-slate-400 whitespace-nowrap">(MÃ¡x: 0)</span>
                                            </div>
                                        </div>
                                        <div id="stock-trend-filter-container" class="flex items-center gap-2">
                                            <button data-trend="all" class="stock-trend-btn active p-1 rounded-full transition-transform duration-200"><div class="w-5 h-5 rounded-full bg-gray-400"></div></button>
                                            <button data-trend="low" class="stock-trend-btn p-1 rounded-full transition-transform duration-200"><div class="w-5 h-5 rounded-full bg-red-500"></div></button>
                                            <button data-trend="medium" class="stock-trend-btn p-1 rounded-full transition-transform duration-200"><div class="w-5 h-5 rounded-full bg-yellow-500"></div></button>
                                            <button data-trend="good" class="stock-trend-btn p-1 rounded-full transition-transform duration-200"><div class="w-5 h-5 rounded-full bg-green-500"></div></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="overflow-auto custom-scrollbar" style="max-height: 60vh;">
                                    <table class="min-w-full text-sm text-left text-slate-300">
                                        <thead class="text-xs text-slate-400 uppercase sticky-header">
                                            <tr>
                                                <th class="px-4 py-3">Produto</th>
                                                <th class="px-4 py-3">Fornecedor</th>
                                                <th class="px-4 py-3 text-right">Estoque Atual (CX.)</th>
                                                <th class="px-4 py-3 text-right">Venda MÃ©dia Mensal (CX.)</th>
                                                <th class="px-4 py-3 text-right">MÃ©dia diÃ¡ria (CX.)</th>
                                                <th class="px-4 py-3 text-right">TendÃªncia (Dias)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="stock-analysis-table-body" class="divide-y divide-slate-700"></tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- Tabelas SecundÃ¡rias (Estoque) -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <h2 class="text-lg font-semibold text-white text-center mb-4">Produtos com Crescimento</h2>
                                    <div class="overflow-auto custom-scrollbar" style="max-height: 40vh;">
                                        <table class="min-w-full text-sm text-slate-300"><thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-2 py-2 text-left">Produto</th><th class="px-2 py-2 text-right">Vendido (Atual)</th><th class="px-2 py-2 text-right">MÃ©dia Trim.</th><th class="px-2 py-2 text-right">VariaÃ§Ã£o</th><th class="px-2 py-2 text-right">Estoque</th></tr></thead><tbody id="growth-table-body" class="divide-y divide-slate-700"></tbody></table>
                                    </div>
                                </div>
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <h2 class="text-lg font-semibold text-white text-center mb-4">Produtos com Queda</h2>
                                    <div class="overflow-auto custom-scrollbar" style="max-height: 40vh;">
                                        <table class="min-w-full text-sm text-slate-300"><thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-2 py-2 text-left">Produto</th><th class="px-2 py-2 text-right">Vendido (Atual)</th><th class="px-2 py-2 text-right">MÃ©dia Trim.</th><th class="px-2 py-2 text-right">VariaÃ§Ã£o</th><th class="px-2 py-2 text-right">Estoque</th></tr></thead><tbody id="decline-table-body" class="divide-y divide-slate-700"></tbody></table>
                                    </div>
                                </div>
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <h2 class="text-lg font-semibold text-white text-center mb-4">Novos - Vendidos este MÃªs</h2>
                                    <div class="overflow-auto custom-scrollbar" style="max-height: 40vh;">
                                        <table class="min-w-full text-sm text-slate-300"><thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-2 py-2 text-left">Produto</th><th class="px-2 py-2 text-right">Vendido (Atual)</th><th class="px-2 py-2 text-right">MÃ©dia Trim.</th><th class="px-2 py-2 text-right">Estoque</th></tr></thead><tbody id="new-products-table-body" class="divide-y divide-slate-700"></tbody></table>
                                    </div>
                                </div>
                                <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <h2 class="text-lg font-semibold text-white text-center mb-4">Perdidos - NÃ£o vendidos este MÃªs</h2>
                                    <div class="overflow-auto custom-scrollbar" style="max-height: 40vh;">
                                        <table class="min-w-full text-sm text-slate-300"><thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-2 py-2 text-left">Produto</th><th class="px-2 py-2 text-right">Vendido (Atual)</th><th class="px-2 py-2 text-right">MÃ©dia Trim.</th><th class="px-2 py-2 text-right">Estoque</th></tr></thead><tbody id="lost-products-table-body" class="divide-y divide-slate-700"></tbody></table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- EcrÃ£ Metas (Goals) -->
                        <div id="goals-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                            <!-- Header with Title and Tabs -->
                            <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex flex-col xl:flex-row justify-between items-start xl:items-center gap-4">
                                    <div class="flex items-center gap-4">
                                        <button class="sidebar-toggle text-white focus:outline-none">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                        </button>
                                        <div>
                                            <h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1>
                                            <p class="text-slate-300">Planejamento de Metas (GV & SV)</p>
                                        </div>
                                    </div>
                                    <!-- Top Right Tabs -->

    <button id="save-goals-btn" class="ml-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
        </svg>
        Salvar Metas
    </button>
    <button id="clear-goals-btn" class="ml-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        Limpar Metas
    </button>
<div class="flex bg-[#161e3d] p-1 rounded-lg border border-slate-700" id="goals-tabs">
                                        <button data-tab="gv" class="px-6 py-2 rounded-md text-sm font-bold transition-colors bg-slate-700 text-white shadow-sm border border-teal-500 text-teal-500 active" id="btn-tab-gv">Rateio Metas</button>
                                        <button data-tab="sv" class="px-6 py-2 rounded-md text-sm font-bold text-slate-400 hover:text-white transition-colors border border-transparent" id="btn-tab-sv">RelatÃ³rio</button>
                                    </div>
                                </div>
                            </header>

                            <!-- Tab Content: SugestÃ£o GV -->
                            <div id="goals-gv-content">
                                <!-- Category Selection Toggles -->
                                <div class="flex flex-col gap-4 mb-6">
                                    <div class="flex gap-4">
                                        <button id="goals-category-pepsico-btn" class="px-8 py-3 bg-[#0d9488] text-white font-bold rounded hover:bg-teal-700 transition-colors uppercase tracking-wider text-sm shadow-lg border border-teal-500/50">PEPSICO</button>
                                        <button id="goals-category-elmachips-btn" class="px-8 py-3 bg-[#334155] text-slate-400 font-bold rounded hover:bg-slate-700 transition-colors uppercase tracking-wider text-sm border border-slate-700">ELMA CHIPS</button>
                                        <button id="goals-category-foods-btn" class="px-8 py-3 bg-[#334155] text-slate-400 font-bold rounded hover:bg-slate-700 transition-colors uppercase tracking-wider text-sm border border-slate-700">FOODS</button>
                                         <button id="goals-category-summary-btn" class="px-8 py-3 bg-[#334155] text-slate-400 font-bold rounded hover:bg-slate-700 transition-colors uppercase tracking-wider text-sm border border-slate-700">RESUMO</button>
                                    </div>

                                    <!-- Sub-tabs Container -->
                                    <div id="goals-sub-tabs-container">
                                        <!-- PEPSICO Sub-tabs -->
                                        <div class="flex border-b border-slate-700 overflow-x-auto" id="goals-sub-tabs-pepsico">
                                            <button data-supplier="PEPSICO_ALL" class="goals-sub-tab px-6 py-3 text-teal-400 font-bold text-sm border-b-2 border-teal-400 flex items-center gap-2 whitespace-nowrap active">
                                                <span class="w-2 h-2 rounded-full bg-teal-400 inline-block indicator"></span> PEPSICO
                                            </button>
                                        </div>

                                        <!-- Elma Chips Sub-tabs -->
                                        <div class="hidden flex border-b border-slate-700 overflow-x-auto" id="goals-sub-tabs-elmachips">
                                            <button data-supplier="ELMA_ALL" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">
                                                ELMA
                                            </button>
                                            <button data-supplier="707" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">EXTRUSADOS</button>
                                            <button data-supplier="708" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">NÃƒO EXTRUSADOS</button>
                                            <button data-supplier="752" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">TORCIDA</button>
                                        </div>

                                        <!-- Foods Sub-tabs -->
                                        <div class="hidden flex border-b border-slate-700 overflow-x-auto" id="goals-sub-tabs-foods">
                                            <button data-supplier="FOODS_ALL" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">FOODS</button>
                                            <button data-supplier="1119" data-brand="TODDYNHO" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">TODDYNHO</button>
                                            <button data-supplier="1119" data-brand="TODDY" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">TODDY</button>
                                            <button data-supplier="1119" data-brand="QUAKER_KEROCOCO" class="goals-sub-tab px-6 py-3 text-slate-400 font-medium text-sm hover:text-white transition-colors whitespace-nowrap">QUAKER / KEROCOCO</button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Summary Content -->
                                <div id="goals-summary-content" class="hidden mb-6">
                                    <!-- Independent Filters for Summary -->
                                    <div class="mb-4 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700 flex flex-col lg:flex-row justify-between items-end gap-4">
                                        <div class="flex flex-col sm:flex-row gap-4 w-full lg:w-auto items-end">
                                            <div class="relative w-full sm:w-64">
                                                <label for="goals-summary-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                                <button id="goals-summary-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                    <span id="goals-summary-supervisor-filter-text">Todos</span>
                                                    <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                                </button>
                                                <div id="goals-summary-supervisor-filter-dropdown" class="hidden absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                            </div>
                                            <button id="clear-goals-summary-filters-btn" class="w-full sm:w-auto bg-slate-600 hover:bg-slate-500 text-white font-bold py-2.5 px-4 rounded-lg">Limpar Filtros</button>
                                        </div>

                                        <!-- Totals Summary -->
                                        <div class="flex flex-wrap gap-6 bg-[#161e3d] p-3 rounded-lg border border-slate-700/50 w-full lg:w-auto justify-end">
                                            <div class="text-right px-2">
                                                <p class="text-[10px] uppercase text-slate-400 font-bold mb-1">Total Meta Fat.</p>
                                                <p class="text-xl font-bold text-teal-400" id="summary-total-fat">R$ 0,00</p>
                                            </div>
                                            <div class="text-right px-2 border-l border-slate-700">
                                                <p class="text-[10px] uppercase text-slate-400 font-bold mb-1">Total Meta Kg</p>
                                                <p class="text-xl font-bold text-orange-400" id="summary-total-vol">0,000</p>
                                            </div>
                                            <div class="text-right px-2 border-l border-slate-700">
                                                <p class="text-[10px] uppercase text-slate-400 font-bold mb-1">Total Meta Pos.</p>
                                                <p class="text-xl font-bold text-purple-400" id="summary-total-pos">0</p>
                                            </div>
                                            <div class="text-right px-2 border-l border-slate-700">
                                                <p class="text-[10px] uppercase text-slate-400 font-bold mb-1">Meta Mix Salty</p>
                                                <p class="text-xl font-bold text-teal-400" id="summary-mix-salty">0</p>
                                            </div>
                                            <div class="text-right px-2 border-l border-slate-700">
                                                <p class="text-[10px] uppercase text-slate-400 font-bold mb-1">Meta Mix Foods</p>
                                                <p class="text-xl font-bold text-yellow-400" id="summary-mix-foods">0</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="goals-summary-grid">
                                        <!-- Summary Cards will be injected here -->
                                    </div>
                                </div>

                                <!-- Meta Input Cards -->
                                <div id="goals-input-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-6 bg-[#161e3d] p-4 rounded-lg border border-slate-700/50">
                                    <!-- Faturamento Card -->
                                    <div class="bg-[#064e3b] kpi-glow-base kpi-glow-green rounded-lg p-3 relative overflow-hidden group shadow-md" style="--card-bg: #064e3b;">
                                        <label class="text-[10px] font-bold text-green-300 uppercase tracking-wider mb-1 block">META FATURAMENTO (R$)</label>
                                        <div class="flex gap-2">
                                            <input type="text" id="goal-global-fat" class="w-full bg-[#0f172a] border border-green-900/50 text-white font-bold text-lg p-2 rounded focus:outline-none focus:border-green-500" value="0,00">
                                            <button id="btn-distribute-fat" class="bg-green-600 hover:bg-green-500 text-white px-3 rounded flex items-center justify-center transition-colors">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                            </button>
                                        </div>
                                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                                            <span>MÃ©dia Trim: <span id="ref-avg-fat" class="text-white font-bold">R$ 0,00</span></span>
                                            <span>MÃªs Ant: <span id="ref-prev-fat" class="text-white font-bold">R$ 0,00</span></span>
                                        </div>
                                    </div>
                                    <!-- Volume Card -->
                                    <div class="bg-[#1e2a5a] kpi-glow-base kpi-glow-blue rounded-lg p-3 relative overflow-hidden group shadow-md" style="--card-bg: #1e2a5a;">
                                        <label class="text-[10px] font-bold text-blue-300 uppercase tracking-wider mb-1 block">META VOLUME (KG)</label>
                                        <div class="flex gap-2">
                                            <input type="text" id="goal-global-vol" class="w-full bg-[#0f172a] border border-blue-900/50 text-white font-bold text-lg p-2 rounded focus:outline-none focus:border-blue-500" value="0,000">
                                            <button id="btn-distribute-vol" class="bg-blue-600 hover:bg-blue-500 text-white px-3 rounded flex items-center justify-center transition-colors">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                            </button>
                                        </div>
                                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                                            <span>MÃ©dia Trim: <span id="ref-avg-vol" class="text-white font-bold">0,000</span></span>
                                            <span>MÃªs Ant: <span id="ref-prev-vol" class="text-white font-bold">0,000</span></span>
                                        </div>
                                    </div>
                                    <!-- PositivaÃ§Ã£o Card -->
                                    <div class="bg-[#3b0764] kpi-glow-base kpi-glow-purple rounded-lg p-3 relative overflow-hidden group shadow-md" style="--card-bg: #3b0764;">
                                        <label class="text-[10px] font-bold text-purple-300 uppercase tracking-wider mb-1 block">META POSITIVAÃ‡ÃƒO</label>
                                        <div class="flex gap-2">
                                            <input type="text" id="goal-global-mix" class="w-full bg-[#0f172a] border border-purple-900/50 text-white font-bold text-lg p-2 rounded focus:outline-none focus:border-purple-500" value="0" readonly>
                                            <button id="btn-distribute-mix" class="bg-purple-600 hover:bg-purple-500 text-white px-3 rounded flex items-center justify-center transition-colors" style="display: none;">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                            </button>
                                        </div>
                                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                                            <span>MÃ©dia Trim: <span id="ref-avg-clients" class="text-white font-bold">0</span></span>
                                            <span>MÃªs Ant: <span id="ref-prev-clients" class="text-white font-bold">0</span></span>
                                        </div>
                                    </div>
                                    <!-- Mix Salty Card (Hidden by Default) -->
                                    <div id="card-mix-salty" class="hidden bg-[#064e3b] kpi-glow-base kpi-glow-green rounded-lg p-3 relative overflow-hidden group shadow-md" style="--card-bg: #064e3b;">
                                        <label class="text-[10px] font-bold text-emerald-300 uppercase tracking-wider mb-1 block">META MIX SALTY</label>
                                        <div class="flex gap-2">
                                            <input type="text" id="goal-global-mix-salty" class="w-full bg-[#0f172a] border border-emerald-900/50 text-white font-bold text-lg p-2 rounded focus:outline-none focus:border-emerald-500" value="0" readonly>
                                            <button id="btn-distribute-mix-salty" class="bg-emerald-600 hover:bg-emerald-500 text-white px-3 rounded flex items-center justify-center transition-colors" style="display: none;">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                            </button>
                                        </div>
                                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                                            <span>50% Ativos</span>
                                        </div>
                                    </div>
                                    <!-- Mix Foods Card (Hidden by Default) -->
                                    <div id="card-mix-foods" class="hidden bg-[#713f12] kpi-glow-base kpi-glow-yellow rounded-lg p-3 relative overflow-hidden group shadow-md" style="--card-bg: #713f12;">
                                        <label class="text-[10px] font-bold text-yellow-300 uppercase tracking-wider mb-1 block">META MIX FOODS</label>
                                        <div class="flex gap-2">
                                            <input type="text" id="goal-global-mix-foods" class="w-full bg-[#0f172a] border border-yellow-900/50 text-white font-bold text-lg p-2 rounded focus:outline-none focus:border-yellow-500" value="0" readonly>
                                            <button id="btn-distribute-mix-foods" class="bg-yellow-600 hover:bg-yellow-500 text-white px-3 rounded flex items-center justify-center transition-colors" style="display: none;">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                                            </button>
                                        </div>
                                        <div class="flex justify-between text-[10px] text-slate-400 mt-1">
                                            <span>30% Ativos</span>
                                        </div>
                                    </div>

                                    <!-- Summary -->
                                    <div id="goals-dist-summary" class="flex flex-col justify-center items-end text-right pr-4">
                                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">TOTAL RATEADO</p>
                                        <p class="text-2xl font-bold text-green-400">100% DistribuÃ­do</p>
                                    </div>
                                </div>

                                <!-- Filters -->
                                <div class="mb-4 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 items-end">
                                        <div id="goals-gv-supervisor-filter-wrapper" class="relative">
                                            <label for="goals-gv-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                            <button id="goals-gv-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="goals-gv-supervisor-filter-text">Todos</span>
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="goals-gv-supervisor-filter-dropdown" class="hidden absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                        <div id="goals-gv-seller-filter-wrapper" class="relative">
                                            <label for="goals-gv-seller-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label>
                                            <button id="goals-gv-seller-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="goals-gv-seller-filter-text">Todos</span>
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="goals-gv-seller-filter-dropdown" class="hidden absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                        <div id="goals-gv-codcli-filter-wrapper">
                                            <label for="goals-gv-codcli-filter" class="block mb-2 text-sm font-medium text-slate-400">CÃ³d. Cliente</label>
                                            <input type="text" id="goals-gv-codcli-filter" placeholder="Digite o cÃ³digo..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5" autocomplete="off">
                                        </div>
                                        <button id="clear-goals-gv-filters-btn" class="w-full bg-slate-600 hover:bg-slate-500 text-white font-bold py-2.5 px-4 rounded-lg">Limpar Filtros</button>
                                    </div>
                                </div>

                                <!-- Main Table -->
                                <div id="goals-table-container" class="bg-[#1d2347] border border-slate-700 shadow-sm rounded-lg overflow-hidden">
                                    <div class="overflow-auto custom-scrollbar" style="max-height: 60vh;">
                                        <table class="min-w-full text-sm text-left text-slate-300 border-collapse">
                                            <thead class="text-xs uppercase sticky top-0 z-20 bg-[#0f172a] text-slate-400">
                                                <tr>
                                                    <th rowspan="2" class="px-2 py-2 text-center w-16 border-r border-b border-slate-700">CÃ“D</th>
                                                    <th rowspan="2" class="px-3 py-2 text-left w-48 border-r border-b border-slate-700">CLIENTE</th>
                                                    <th rowspan="2" class="px-3 py-2 text-left w-24 border-r border-b border-slate-700">VENDEDOR</th>
                                                    <th colspan="3" class="px-2 py-1 text-center bg-blue-900/30 text-blue-400 border-r border-slate-700 border-b-0">FATURAMENTO (R$)</th>
                                                    <th colspan="3" class="px-2 py-1 text-center bg-orange-900/30 text-orange-400 border-r border-slate-700 border-b-0">VOLUME (KG)</th>
                                                    <th rowspan="2" class="px-2 py-2 text-center w-16 bg-purple-900/20 text-purple-300 font-bold border-b border-slate-700">META POS.</th>
                                                </tr>
                                                <tr>
                                                    <!-- Fat Headers -->
                                                    <th class="px-2 py-2 text-right w-24 bg-blue-900/20 text-blue-300 border-r border-b border-slate-700/50 text-[10px]">MÃ‰DIA</th>
                                                    <th class="px-2 py-2 text-center w-16 bg-blue-900/20 text-blue-300 border-r border-b border-slate-700/50 text-[10px]">% SHARE</th>
                                                    <th class="px-2 py-2 text-right w-24 bg-blue-900/20 text-blue-100 font-bold border-r border-b border-slate-700 text-[10px]">META AUTO</th>
                                                    <!-- Vol Headers -->
                                                    <th class="px-2 py-2 text-right w-24 bg-orange-900/20 text-orange-300 border-r border-b border-slate-700/50 text-[10px]">MÃ‰DIA KG</th>
                                                    <th class="px-2 py-2 text-center w-16 bg-orange-900/20 text-orange-300 border-r border-b border-slate-700/50 text-[10px]">% SHARE</th>
                                                    <th class="px-2 py-2 text-right w-24 bg-orange-900/20 text-orange-100 font-bold border-r border-b border-slate-700 text-[10px]">META KG</th>
                                                </tr>
                                            </thead>
                                            <tbody id="goals-gv-table-body" class="divide-y divide-slate-800 bg-[#151c36]">
                                                <!-- Rows will be populated by JS -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Pagination Controls -->
                                    <div id="goals-pagination-controls" class="hidden flex justify-between items-center p-4 bg-[#161e3d] border-t border-slate-700">
                                        <button id="goals-prev-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50 text-xs" disabled>Anterior</button>
                                        <span id="goals-page-info-text" class="text-slate-400 text-xs">PÃ¡gina 1 de 1</span>
                                        <button id="goals-next-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50 text-xs" disabled>PrÃ³xima</button>
                                    </div>
                                </div>
                            </div> <!-- End goals-gv-content -->

                            <!-- Tab Content: Meta SV -->
                            <div id="goals-sv-content" class="hidden">
                                <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                    <div class="flex flex-col md:flex-row justify-between items-end gap-4">
                                        <div class="relative w-full md:w-64">
                                            <label for="goals-sv-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                            <button id="goals-sv-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                                <span id="goals-sv-supervisor-filter-text">Todos</span>
                                                <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="goals-sv-supervisor-filter-dropdown" class="hidden absolute z-50 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                        <button id="goals-sv-export-xlsx-btn" class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-2.5 px-6 rounded-lg flex items-center justify-center gap-2 shadow-lg transition-colors">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                            Exportar Excel
                                        </button>
                                    </div>
                                </div>

                                <!-- Consolidated Table (SV) -->
                                <div id="goals-sv-table-container" class="bg-[#1d2347] border border-slate-700 shadow-sm rounded-lg overflow-hidden">
                                    <div class="overflow-auto custom-scrollbar" style="max-height: 75vh;">
                                        <table class="min-w-full text-sm text-left text-slate-300 border-collapse" id="goals-sv-main-table">
                                            <!-- Headers populated by JS -->
                                            <tbody id="goals-sv-table-body" class="divide-y divide-slate-800 bg-[#151c36]"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- EcrÃ£ InovaÃ§Ãµes MÃªs -->
                        <div id="innovations-month-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                             <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex items-center gap-4">
                                    <button class="sidebar-toggle text-white focus:outline-none">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    </button>
                                    <div class="flex-1 flex flex-col sm:flex-row justify-between items-center gap-4">
                                        <div><h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1><p class="text-lg text-slate-300 -mt-1">GrÃ¡fico de Cobertura por Categoria de InovaÃ§Ã£o</p></div>
                                        <button id="export-innovations-month-pdf-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Exportar PDF</button>
                                    </div>
                                </div>
                            </header>
                             <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-6">
                                <div class="kpi-card kpi-glow-base kpi-glow-blue transition transform hover:-translate-y-1 duration-200"><p class="text-slate-400 text-sm font-medium">Clientes Ativos (Filtro)</p><p id="innovations-month-active-clients-kpi" class="text-3xl font-bold text-teal-400 my-1">0</p><p class="text-xs text-slate-500">Base para os KPIs</p></div>
                                <div class="kpi-card kpi-glow-base kpi-glow-yellow transition transform hover:-translate-y-1 duration-200"><p class="text-slate-400 text-sm font-medium">Cobertura MÃªs Anterior</p><p id="innovations-month-selection-coverage-value-kpi-previous" class="text-3xl font-bold text-orange-400 my-1">0%</p><p id="innovations-month-selection-coverage-count-kpi-previous" class="text-xs text-slate-500">0 de 0 clientes</p></div>
                                <div class="kpi-card kpi-glow-base kpi-glow-green transition transform hover:-translate-y-1 duration-200"><p class="text-slate-400 text-sm font-medium">Cobertura MÃªs Atual</p><p id="innovations-month-selection-coverage-value-kpi" class="text-3xl font-bold text-cyan-400 my-1">0%</p><p id="innovations-month-selection-coverage-count-kpi" class="text-xs text-slate-500">0 de 0 clientes</p></div>
                                <div class="kpi-card kpi-glow-base kpi-glow-yellow transition transform hover:-translate-y-1 duration-200"><p class="text-slate-400 text-sm font-medium">Cobertura BonificaÃ§Ã£o Ant.</p><p id="innovations-month-bonus-coverage-value-kpi-previous" class="text-3xl font-bold text-orange-400 my-1">0%</p><p id="innovations-month-bonus-coverage-count-kpi-previous" class="text-xs text-slate-500">0 de 0 clientes</p></div>
                                <div class="kpi-card kpi-glow-base kpi-glow-green transition transform hover:-translate-y-1 duration-200"><p class="text-slate-400 text-sm font-medium">Cobertura BonificaÃ§Ã£o Atual</p><p id="innovations-month-bonus-coverage-value-kpi" class="text-3xl font-bold text-cyan-400 my-1">0%</p><p id="innovations-month-bonus-coverage-count-kpi" class="text-xs text-slate-500">0 de 0 clientes</p></div>
                                <div class="kpi-card kpi-glow-base kpi-glow-purple transition transform hover:-translate-y-1 duration-200"><p id="innovations-month-top-coverage-title" class="text-slate-400 text-sm font-medium">Item com Maior Cobertura</p><p id="innovations-month-top-coverage-value-kpi" class="text-3xl font-bold text-purple-400 my-1">0%</p><p id="innovations-month-top-coverage-kpi" class="text-xs text-slate-500 truncate" title="Nenhum item analisado">-</p><p id="innovations-month-top-coverage-count-kpi" class="text-xs text-slate-500">0 PDVs</p></div>
                            </div>
                            <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 items-end">
                                    <div class="relative">
                                        <label for="innovations-month-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                        <button id="innovations-month-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="innovations-month-supervisor-filter-text">Todos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="innovations-month-supervisor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div class="relative"><label for="innovations-month-vendedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label><button id="innovations-month-vendedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="innovations-month-vendedor-filter-text">Todos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="innovations-month-vendedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div class="relative"><label for="innovations-month-city-filter" class="block mb-2 text-sm font-medium text-slate-400">Cidade</label><input type="text" id="innovations-month-city-filter" placeholder="Digite a cidade..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5" autocomplete="off"><div id="innovations-month-city-suggestions" class="absolute z-10 w-full bg-slate-800 border border-slate-600 rounded-lg mt-1 hidden max-h-48 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div><label for="innovations-month-filial-filter" class="block mb-2 text-sm font-medium text-slate-400">Filial</label><select id="innovations-month-filial-filter" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5"><option value="ambas" selected>Ambas</option><option value="05">Filial 05</option><option value="08">Filial 08</option></select></div>
                                    <div class="relative">
                                        <label for="innovations-month-tipo-venda-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Tipo Venda</label>
                                        <button id="innovations-month-tipo-venda-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="innovations-month-tipo-venda-filter-text">Todos os Tipos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="innovations-month-tipo-venda-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <button id="clear-innovations-month-filters-btn" class="w-full bg-slate-600 hover:bg-slate-500 text-white font-bold py-2.5 px-4 rounded-lg">Limpar Filtros</button>
                                </div>
                                <div class="mt-4 border-t border-slate-700 pt-4">
                                    <label for="innovations-month-category-filter" class="block mb-2 text-sm font-medium text-slate-400">Filtrar por Categoria de InovaÃ§Ã£o</label>
                                    <select id="innovations-month-category-filter" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5"><option value="">Todas as Categorias</option></select>
                                </div>
                            </div>
                            <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm mb-6">
                                <div id="innovations-month-chartContainer" class="relative h-96"></div>
                            </div>
                            <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm mb-6">
                                <h2 class="text-lg font-semibold text-white mb-4 text-center">Dados do GrÃ¡fico</h2>
                                <div class="overflow-auto custom-scrollbar" style="max-height: 60vh;">
                                    <table class="min-w-full text-sm text-left text-slate-300">
                                        <thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-2 py-2">CATEGORIA</th><th class="px-2 py-2">PRODUTO</th><th class="px-2 py-2 text-right">ESTOQUE CAIXAS</th><th class="px-2 py-2 text-right">COBERTURA MÃŠS ANT.</th><th class="px-2 py-2 text-right">COBERTURA MÃŠS ATUAL</th><th class="px-2 py-2 text-right">VARIAÃ‡ÃƒO</th></tr></thead>
                                        <tbody id="innovations-month-table-body" class="divide-y divide-slate-700"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                <h2 class="text-lg font-semibold text-white mb-2 text-center">InovaÃ§Ãµes por cliente</h2>
                                <div id="innovations-by-client-legend" class="text-xs text-slate-400 mb-4 p-2 bg-slate-800 rounded"></div>
                                <div class="overflow-auto custom-scrollbar" style="max-height: 60vh;">
                                    <table class="min-w-full text-sm text-left text-slate-300">
                                        <thead id="innovations-by-client-table-head" class="text-xs text-slate-400 uppercase sticky-header"></thead>
                                        <tbody id="innovations-by-client-table-body" class="divide-y divide-slate-700"></tbody>
                                    </table>
                                </div>
                                <!-- PaginaÃ§Ã£o da Tabela InovaÃ§Ãµes -->
                                <div id="innovations-pagination-controls" class="hidden mt-4 flex justify-between items-center">
                                    <button id="innovations-prev-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50" disabled>Anterior</button>
                                    <span id="innovations-page-info-text" class="text-slate-400">PÃ¡gina 1 de 1</span>
                                    <button id="innovations-next-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50" disabled>PrÃ³xima</button>
                                </div>
                            </div>
                        </div>

                        <!-- EcrÃ£ Mix (Novo) -->
                        <div id="mix-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                            <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex items-center gap-4">
                                    <button class="sidebar-toggle text-white focus:outline-none">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    </button>
                                    <div class="flex-1 flex flex-col sm:flex-row justify-between items-center gap-4">
                                        <div>
                                            <h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1>
                                            <div class="flex items-center gap-2">
                                                <p class="text-lg text-slate-300 -mt-1">AnÃ¡lise de Oportunidades (Mix Salty & Foods)</p>
                                                <div class="relative group">
                                                    <svg class="w-5 h-5 text-slate-400 cursor-help hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                                    <div class="absolute left-0 top-full mt-2 w-72 p-4 bg-slate-800 border border-slate-600 rounded-lg shadow-xl text-xs text-slate-300 hidden group-hover:block z-50">
                                                        <p class="font-bold text-white mb-2 border-b border-slate-600 pb-1">Requisitos de PositivaÃ§Ã£o:</p>
                                                        <ul class="list-disc list-inside mb-3 text-slate-400 space-y-1">
                                                            <li>Venda com Quantidade > 0</li>
                                                            <li>Respeita filtros ativos (ex: Tipo Venda)</li>
                                                        </ul>
                                                        <p class="font-bold text-teal-400 mb-1">Mix Salty (Marcas):</p>
                                                        <p class="mb-2">CHEETOS, DORITOS, FANDANGOS, RUFFLES, TORCIDA</p>
                                                        <p class="font-bold text-yellow-400 mb-1">Mix Foods (Marcas):</p>
                                                        <p>TODDYNHO, TODDY, QUAKER, KEROCOCO</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <button id="export-mix-pdf-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Exportar PDF</button>
                                    </div>
                                </div>
                            </header>

                            <!-- KPIs -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                                <div class="kpi-card transition transform hover:-translate-y-1 duration-200">
                                    <div class="grid grid-cols-3 items-center mb-1">
                                        <div class="col-span-1"></div> <!-- Spacer -->
                                        <div class="col-span-1 text-center">
                                            <span id="mix-kpi-title" class="text-slate-400 text-sm font-medium">Total Clientes (Filtro)</span>
                                        </div>
                                        <div class="col-span-1 flex justify-end">
                                            <label for="mix-kpi-toggle" class="flex items-center cursor-pointer" title="Alternar base de cÃ¡lculo">
                                                <div class="relative">
                                                    <input type="checkbox" id="mix-kpi-toggle" class="sr-only peer">
                                                    <div class="w-10 h-5 bg-slate-600 rounded-full peer-checked:bg-teal-800 transition-colors"></div>
                                                    <div class="absolute left-0.5 top-0.5 bg-white w-4 h-4 rounded-full transition-transform peer-checked:translate-x-full peer-checked:bg-teal-300"></div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                    <p id="mix-total-clients-kpi" class="text-3xl font-bold text-white my-1">0</p>
                                    <p class="text-xs text-slate-500">Base para anÃ¡lise</p>
                                </div>
                                <div class="kpi-card kpi-glow-base kpi-glow-green transition transform hover:-translate-y-1 duration-200">
                                    <p class="text-slate-400 text-sm font-medium">Positivados Salty</p>
                                    <p id="mix-salty-kpi" class="text-3xl font-bold text-teal-400 my-1">0%</p>
                                    <p id="mix-salty-count-kpi" class="text-xs text-slate-500">0 clientes</p>
                                </div>
                                <div class="kpi-card kpi-glow-base kpi-glow-yellow transition transform hover:-translate-y-1 duration-200">
                                    <p class="text-slate-400 text-sm font-medium">Positivados Foods</p>
                                    <p id="mix-foods-kpi" class="text-3xl font-bold text-yellow-400 my-1">0%</p>
                                    <p id="mix-foods-count-kpi" class="text-xs text-slate-500">0 clientes</p>
                                </div>
                                <div class="kpi-card kpi-glow-base kpi-glow-purple transition transform hover:-translate-y-1 duration-200">
                                    <p class="text-slate-400 text-sm font-medium">Mix Ideal (Ambos)</p>
                                    <p id="mix-both-kpi" class="text-3xl font-bold text-purple-400 my-1">0%</p>
                                    <p id="mix-both-count-kpi" class="text-xs text-slate-500">0 clientes</p>
                                </div>
                            </div>

                            <!-- Filtros -->
                            <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                <div id="mix-rede-filter-wrapper" class="mb-4">
                                    <label class="block mb-2 text-sm font-medium text-slate-400">Rede</label>
                                    <div id="mix-rede-group-container" class="inline-flex rounded-md shadow-sm" role="group">
                                        <button type="button" data-group="" class="group-btn active py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-l-lg hover:bg-slate-600">Todos</button>
                                        <div class="relative">
                                            <button type="button" data-group="com_rede" id="mix-com-rede-btn" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border-t border-b border-slate-600 hover:bg-slate-600 flex items-center justify-center gap-2">
                                                <span id="mix-com-rede-btn-text">Com Rede</span>
                                                <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                            </button>
                                            <div id="mix-rede-filter-dropdown" class="hidden absolute z-20 w-56 mt-1 top-full left-0 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-left text-white"></div>
                                        </div>
                                        <button type="button" data-group="sem_rede" class="group-btn py-2 px-4 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-r-lg hover:bg-slate-600">Sem Rede</button>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
                                    <div class="relative">
                                        <label for="mix-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                        <button id="mix-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="mix-supervisor-filter-text">Todos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="mix-supervisor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div class="relative">
                                        <label for="mix-vendedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label>
                                        <button id="mix-vendedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="mix-vendedor-filter-text">Todos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="mix-vendedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div class="relative">
                                        <label for="mix-city-filter" class="block mb-2 text-sm font-medium text-slate-400">Cidade</label>
                                        <input type="text" id="mix-city-filter" placeholder="Digite a cidade..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5" autocomplete="off">
                                        <div id="mix-city-suggestions" class="absolute z-10 w-full bg-slate-800 border border-slate-600 rounded-lg mt-1 hidden max-h-48 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div>
                                        <label for="mix-filial-filter" class="block mb-2 text-sm font-medium text-slate-400">Filial</label>
                                        <select id="mix-filial-filter" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5">
                                            <option value="ambas" selected>Ambas</option>
                                            <option value="05">Filial 05</option>
                                            <option value="08">Filial 08</option>
                                        </select>
                                    </div>
                                    <div class="relative">
                                        <label for="mix-tipo-venda-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Tipo Venda</label>
                                        <button id="mix-tipo-venda-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="mix-tipo-venda-filter-text">Todos os Tipos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="mix-tipo-venda-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                </div>
                                <div class="mt-4 flex justify-center">
                                    <button id="clear-mix-filters-btn" class="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded-lg">Limpar Filtros</button>
                                </div>
                            </div>

                            <!-- GrÃ¡ficos -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                <div class="lg:col-span-1 bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <h2 class="text-lg font-semibold text-white mb-4 text-center">DistribuiÃ§Ã£o do Mix</h2>
                                    <div id="mixDistributionChartContainer" class="relative h-64 flex items-center justify-center"></div>
                                </div>
                                <div class="lg:col-span-2 bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                    <h2 class="text-lg font-semibold text-white mb-4 text-center">EficiÃªncia por Vendedor (Top 10)</h2>
                                    <div id="mixSellerChartContainer" class="relative h-64"></div>
                                </div>
                            </div>

                            <!-- Tabela Detalhada -->
                            <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold text-white">Detalhamento de Oportunidades por Cliente</h2>
                                </div>
                                <div class="overflow-auto custom-scrollbar" style="max-height: 60vh;">
                                    <table class="min-w-full text-sm text-left text-slate-300">
                                        <thead class="text-xs text-slate-400 uppercase sticky top-0 z-20 bg-slate-800">
                                            <tr>
                                                <th rowspan="2" class="px-2 py-3 text-left border-b border-slate-500">CÃ³d</th>
                                                <th rowspan="2" class="px-2 py-3 text-left border-b border-slate-500">Cliente</th>
                                                <th rowspan="2" class="px-2 py-3 text-left border-b border-slate-500">Cidade</th>
                                                <th rowspan="2" class="px-2 py-3 text-left border-b border-slate-500">Vendedor</th>
                                                <th colspan="5" class="px-1 py-2 text-center border-b-0 border-slate-500 text-teal-400">Mix Salty</th>
                                                <th colspan="4" class="px-1 py-2 text-center border-b-0 border-slate-500 text-yellow-400">Mix Foods</th>
                                            </tr>
                                            <tr>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">CHEETOS</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">DORITOS</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">FANDANGOS</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">RUFFLES</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">TORCIDA</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">TODDYNHO</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">TODDY</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">QUAKER</th>
                                                <th class="px-1 py-1 text-center border-l border-b border-slate-500 text-[10px]">KEROCOCO</th>
                                            </tr>
                                        </thead>
                                        <tbody id="mix-table-body" class="divide-y divide-slate-700"></tbody>
                                    </table>
                                </div>
                                <!-- PaginaÃ§Ã£o da Tabela Mix -->
                                <div id="mix-pagination-controls" class="hidden mt-4 flex justify-between items-center">
                                    <button id="mix-prev-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50" disabled>Anterior</button>
                                    <span id="mix-page-info-text" class="text-slate-400">PÃ¡gina 1 de 1</span>
                                    <button id="mix-next-page-btn" class="bg-slate-700 border border-slate-600 hover:bg-slate-600 text-slate-300 font-bold py-2 px-4 rounded-lg disabled:opacity-50" disabled>PrÃ³xima</button>
                                </div>
                            </div>
                        </div>

                        <!-- EcrÃ£ Cobertura (Novo) -->
                        <div id="coverage-view" class="hidden container mx-auto p-4 sm:p-6 lg:p-8">
                            <header class="mb-6 -mt-4 -mx-4 sm:-mt-6 sm:-mx-6 lg:-mt-8 lg:-mx-8 p-6 bg-gradient-to-r from-[#1e2a5a] to-[#0d1126] rounded-b-lg shadow-lg">
                                <div class="flex items-center gap-4">
                                    <button class="sidebar-toggle text-white focus:outline-none">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                    </button>
                                    <div class="flex-1 flex flex-col sm:flex-row justify-between items-center gap-4">
                                        <div><h1 class="text-2xl font-bold text-white">PAINEL DE VENDAS - <span class="text-yellow-300">PRIME</span> DISTRIBUIÃ‡ÃƒO</h1><p class="text-lg text-slate-300 -mt-1">AnÃ¡lise de Cobertura (Estoque x PDVs)</p></div>
                                        <button id="export-coverage-pdf-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Exportar PDF</button>
                                    </div>
                                </div>
                            </header>
                            <!-- KPIs (Cobertura) -->
                             <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                                <div class="kpi-card kpi-glow-base kpi-glow-blue transition transform hover:-translate-y-1 duration-200">
                                    <p class="text-slate-400 text-sm font-medium">Clientes Ativos (Filtro)</p>
                                    <p id="coverage-active-clients-kpi" class="text-3xl font-bold text-teal-400 my-1">0</p>
                                    <p class="text-xs text-slate-500">Base para os KPIs</p>
                                </div>
                                <div class="kpi-card kpi-glow-base kpi-glow-yellow transition transform hover:-translate-y-1 duration-200">
                                    <p class="text-slate-400 text-sm font-medium">Cobertura MÃªs Anterior</p>
                                    <p id="coverage-selection-coverage-value-kpi-previous" class="text-3xl font-bold text-orange-400 my-1">0%</p>
                                    <p id="coverage-selection-coverage-count-kpi-previous" class="text-xs text-slate-500">0 de 0 clientes</p>
                                </div>
                                <div class="kpi-card kpi-glow-base kpi-glow-green transition transform hover:-translate-y-1 duration-200">
                                    <p class="text-slate-400 text-sm font-medium">Cobertura MÃªs Atual</p>
                                    <p id="coverage-selection-coverage-value-kpi" class="text-3xl font-bold text-cyan-400 my-1">0%</p>
                                    <p id="coverage-selection-coverage-count-kpi" class="text-xs text-slate-500">0 de 0 clientes</p>
                                </div>
                                <div class="kpi-card kpi-glow-base kpi-glow-purple transition transform hover:-translate-y-1 duration-200">
                                    <p class="text-slate-400 text-sm font-medium">Item com Maior Cobertura</p>
                                    <p id="coverage-top-coverage-value-kpi" class="text-3xl font-bold text-purple-400 my-1">0%</p>
                                    <p id="coverage-top-coverage-product-kpi" class="text-xs text-slate-500 truncate" title="Nenhum item analisado">-</p>
                                </div>
                            </div>
                            <!-- Filtros (Cobertura) -->
                            <div class="mb-6 p-4 bg-[#1d2347] rounded-lg shadow-sm border border-slate-700">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-4">
                                    <div class="relative">
                                        <label for="coverage-supervisor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Supervisor</label>
                                        <button id="coverage-supervisor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="coverage-supervisor-filter-text">Todos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="coverage-supervisor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div class="relative"><label for="coverage-vendedor-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Vendedor</label><button id="coverage-vendedor-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="coverage-vendedor-filter-text">Todos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="coverage-vendedor-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div class="relative"><label for="coverage-supplier-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Fornecedor</LabeL><button id="coverage-supplier-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="coverage-supplier-filter-text">Todos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button><div id="coverage-supplier-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div class="relative"><label for="coverage-city-filter" class="block mb-2 text-sm font-medium text-slate-400">Cidade</label><input type="text" id="coverage-city-filter" placeholder="Digite a cidade..." class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5" autocomplete="off"><div id="coverage-city-suggestions" class="absolute z-10 w-full bg-slate-800 border border-slate-600 rounded-lg mt-1 hidden max-h-48 overflow-y-auto custom-scrollbar text-white"></div></div>
                                    <div><label for="coverage-filial-filter" class="block mb-2 text-sm font-medium text-slate-400">Filial</label><select id="coverage-filial-filter" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5"><option value="ambas" selected>Ambas</option><option value="05">Filial 05</option><option value="08">Filial 08</option></select></div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 items-end">
                                    <div class="lg:col-span-2 relative">
                                        <label for="coverage-product-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Produto</label>
                                        <button id="coverage-product-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500"><span id="coverage-product-filter-text">Todos os Produtos</span><svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>
                                        <div id="coverage-product-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg">
                                            <div class="p-2 border-b border-slate-700"><input type="text" id="coverage-product-search-input" placeholder="Buscar produto..." class="bg-slate-600 text-xs rounded-lg block w-full p-2 border border-slate-500 placeholder-slate-400 text-white focus:outline-none focus:ring-2 focus:ring-teal-500"></div>
                                            <div id="coverage-product-list" class="max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                        </div>
                                    </div>
                                     <div class="relative">
                                        <label for="coverage-tipo-venda-filter-btn" class="block mb-2 text-sm font-medium text-slate-400">Tipo Venda</label>
                                        <button id="coverage-tipo-venda-filter-btn" class="w-full bg-slate-700 border border-slate-600 text-white text-sm rounded-lg p-2.5 text-left flex justify-between items-center focus:outline-none focus:ring-2 focus:ring-teal-500">
                                            <span id="coverage-tipo-venda-filter-text">Todos os Tipos</span>
                                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        <div id="coverage-tipo-venda-filter-dropdown" class="hidden absolute z-20 w-full mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto custom-scrollbar text-white"></div>
                                    </div>
                                    <div>
                                        <label for="coverage-unit-price-filter" class="block mb-2 text-sm font-medium text-slate-400">Valor UnitÃ¡rio</label>
                                        <input type="number" id="coverage-unit-price-filter" placeholder="Ex: 1.89" step="0.01" class="bg-slate-700 border border-slate-600 text-white text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 block w-full p-2.5">
                                    </div>
                                    <button id="clear-coverage-filters-btn" class="w-full bg-slate-600 hover:bg-slate-500 text-white font-bold py-2.5 px-4 rounded-lg">Limpar Filtros</button>
                                </div>
                            </div>
                            <div class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm mb-6">
                                <div class="flex justify-between items-center mb-4 relative">
                                    <div class="absolute left-0 top-0 bottom-0 flex items-center">
                                        <div class="text-left">
                                            <p class="text-xs text-slate-400">Total Caixas</p>
                                            <p id="coverage-total-boxes" class="text-lg font-bold text-white">0</p>
                                        </div>
                                    </div>
                                    <h2 id="coverage-chart-title" class="text-lg font-semibold text-white text-center w-full">Top 10 Cidades (Quantidade de Caixas)</h2>
                                    <div class="absolute right-0 top-0 bottom-0 flex items-center">
                                        <button id="coverage-chart-toggle-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold py-1 px-3 rounded shadow">Ver Vendedores</button>
                                    </div>
                                </div>
                                <div id="coverageCityChartContainer" class="relative h-80"></div>
                                <div id="coverageSellerChartContainer" class="relative h-80 hidden"></div>
                            </div>
                            <!-- Tabela (Cobertura) -->
                            <div id="coverage-table-container" class="bg-[#1d2347] p-4 rounded-lg border border-slate-700 shadow-sm">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold text-white">Resultados da AnÃ¡lise</h2>
                                </div>
                                <div id="coverage-results" class="overflow-auto custom-scrollbar" style="max-height: 60vh;">
                                    <table class="min-w-full text-sm text-left text-slate-300">
                                        <thead class="text-xs text-slate-400 uppercase sticky-header">
                                            <tr><th class="px-2 py-2">PRODUTO</th><th class="px-2 py-2 text-right">ESTOQUE (Cx)</th><th class="px-2 py-2 text-right">QTD. CAIXAS (MÃŠS ANT.)</th><th class="px-2 py-2 text-right">QTD. CAIXAS (MÃŠS)</th><th class="px-2 py-2 text-right">CAIXAS (%)</th><th class="px-2 py-2 text-right">PDVs MÃŠS ANT.</th><th class="px-2 py-2 text-right">PDVs MÃŠS ATUAL</th><th class="px-2 py-2 text-right">COBERTURA (%)</th></tr>
                                        </thead>
                                        <tbody id="coverage-table-body" class="divide-y divide-slate-700"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Modal Detalhes do Pedido -->
                        <div id="order-details-modal" class="modal-overlay hidden">
                            <div class="bg-slate-800 rounded-lg shadow-2xl max-w-4xl w-full m-4 border border-slate-700">
                                <div class="p-6 border-b border-slate-700 flex justify-between items-center"><h2 class="text-xl font-bold text-white">Detalhes do Pedido <span id="modal-pedido-id"></span></h2><button id="modal-close-btn" class="text-slate-400 hover:text-white text-3xl">&times;</button></div>
                                <div id="modal-header-info" class="p-6 text-left grid grid-cols-2 md:grid-cols-3 gap-4 text-sm text-slate-300"></div>
                                <div class="custom-scrollbar" style="max-height: 50vh; overflow-y: auto;">
                                    <table class="min-w-full text-sm text-left text-slate-300">
                                        <thead class="text-xs text-slate-400 uppercase sticky-header"><tr><th class="px-4 py-3">Produto</th><th class="px-4 py-3 text-right">Quantidade</th><th class="px-4 py-3 text-right">Peso (Kg)</th><th class="px-4 py-3 text-right">Valor UnitÃ¡rio</th></tr></thead>
                                        <tbody id="modal-table-body" class="divide-y divide-slate-700"></tbody>
                                    </table>
                                </div>
                                <div id="modal-footer-total" class="p-6 border-t border-slate-700 flex justify-between items-center"></div>
                            </div>
                        </div>

                        <!-- Modal Detalhes do Cliente -->
                        <div id="client-details-modal" class="modal-overlay hidden">
                            <div class="bg-slate-800 rounded-lg shadow-2xl max-w-2xl w-full m-4 border border-slate-700">
                                <div class="p-6 border-b border-slate-700 flex justify-between items-center"><h2 class="text-xl font-bold text-white">Resumo Cadastral</h2><button id="client-modal-close-btn" class="text-slate-400 hover:text-white text-3xl">&times;</button></div>
                                <div id="client-modal-content" class="p-6 text-slate-300"></div>
                            </div>
                        </div>

                        <!-- Modal Feriados -->
                        <div id="holiday-modal" class="modal-overlay hidden">
                            <div class="bg-slate-800 rounded-lg shadow-2xl max-w-xs w-full m-4 text-slate-300 border border-slate-700">
                                <div class="p-4 border-b border-slate-700 flex justify-between items-center">
                                    <h2 class="text-lg font-bold text-white">Selecionar Feriados</h2>
                                    <button id="holiday-modal-close-btn" class="text-slate-400 hover:text-white text-3xl">&times;</button>
                                </div>
                                <div class="p-4">
                                    <div id="calendar-container"></div>
                                </div>
                                <div class="p-4 border-t border-slate-700 text-right">
                                    <button id="holiday-modal-done-btn" class="bg-teal-500 hover:bg-teal-400 text-white font-bold py-2 px-4 rounded-lg">Confirmar</button>
                                </div>
                            </div>
                        </div>

                        <!-- Modal ConfirmaÃ§Ã£o -->
                        <div id="confirmation-modal" class="modal-overlay hidden">
                            <div class="bg-slate-800 rounded-lg shadow-2xl max-w-md w-full m-4 text-slate-300 border border-slate-700">
                                <div class="p-4 border-b border-slate-700">
                                    <h2 class="text-lg font-bold text-white">Confirmar AÃ§Ã£o</h2>
                                </div>
                                <div class="p-6">
                                    <p id="confirmation-message" class="text-base"></p>
                                </div>
                                <div class="p-4 border-t border-slate-700 flex justify-end gap-3">
                                    <button id="confirmation-cancel-btn" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">Cancelar</button>
                                    <button id="confirmation-confirm-btn" class="px-4 py-2 bg-teal-600 hover:bg-teal-500 text-white font-bold rounded-lg transition-colors">Confirmar</button>
                                </div>
                            </div>
                        </div>
                        </div> <!-- End content-wrapper -->


<div id="master-key-modal" class="modal-overlay hidden">
    <div class="bg-[#1d2347] rounded-lg shadow-2xl max-w-sm w-full m-4 border border-slate-700 p-6 text-center">
        <h2 class="text-xl font-bold text-white mb-4">AutorizaÃ§Ã£o NecessÃ¡ria</h2>
        <p class="text-slate-400 mb-6">Digite a Chave Secreta (service_role) para salvar as metas.</p>
        <input type="password" id="master-key-input" class="w-full bg-[#0f172a] border border-slate-600 text-white rounded-lg p-2 mb-4 focus:outline-none focus:border-teal-500" placeholder="Cole sua chave secreta aqui...">
        <div class="flex justify-end gap-3">
            <button id="master-key-cancel" class="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded-lg">Cancelar</button>
            <button id="master-key-confirm" class="bg-teal-600 hover:bg-teal-500 text-white font-bold py-2 px-4 rounded-lg">Confirmar</button>
        </div>
    </div>
</div>

</div>

<script>
    const SUPABASE_URL = 'https://dhozwhfmrwiumwpcqabi.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRob3p3aGZtcndpdW13cGNxYWJpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNjMzNjAsImV4cCI6MjA3NzgzOTM2MH0.syWqcBCbfH5Ey5AB4NGrsF2-ZuBw4W3NZAPIAZb6Bq4';

    // Helper to UPPERCASE keys
    function mapKeysToUpper(data, type) {
        if (!data || data.length === 0) return [];
        return data.map(item => {
            const newItem = {};
            for (const key in item) {
                // Mapeamentos especÃ­ficos se necessÃ¡rio, ou apenas Upper
                let newKey = key.toUpperCase();
                // Ajustes finos para corresponder exatamente ao que o script espera
                if (type === 'clients') {
                    if (newKey === 'CODIGO_CLIENTE') newKey = 'CÃ³digo'; // Special case for Clients
                    if (newKey === 'RCA1') newKey = 'RCA 1';
                    if (newKey === 'RCA2') newKey = 'RCA 2';
                    if (newKey === 'NOMECLIENTE') newKey = 'Cliente';
                    if (newKey === 'RAZAOSOCIAL') newKey = 'Cliente'; // Fallback
                    if (newKey === 'ULTIMACOMPRA') newKey = 'Data da Ãšltima Compra';
                    if (newKey === 'DATACADASTRO') newKey = 'Data e Hora de Cadastro';
                    if (newKey === 'INSCRICAOESTADUAL') newKey = 'Insc. Est. / Produtor';
                    if (newKey === 'CNPJ_CPF') newKey = 'CNPJ/CPF';
                    if (newKey === 'ENDERECO') newKey = 'EndereÃ§o Comercial';
                    if (newKey === 'TELEFONE') newKey = 'Telefone Comercial';
                    if (newKey === 'DESCRICAO') newKey = 'Descricao'; // For Client
                }

                // For Sales/History (Already match mostly, just need verify)
                if (newKey === 'CLIENTE_NOME') newKey = 'CLIENTE_NOME'; // Keep as is if script uses it

                // ValidaÃ§Ã£o de tipos
                if (item[key] !== null) {
                    if (newKey === 'DTPED' || newKey === 'DTSAIDA' || newKey === 'Data da Ãšltima Compra' || newKey === 'Data e Hora de Cadastro') {
                         // Ensure it's a valid date string or timestamp
                         newItem[newKey] = item[key];
                    } else if (newKey === 'QTVENDA' || newKey === 'VLVENDA' || newKey === 'VLBONIFIC' || newKey === 'TOTPESOLIQ' || newKey === 'ESTOQUECX' || newKey === 'ESTOQUEUNIT' || newKey === 'PEDIDO') {
                         // Force numeric conversion for sales metrics
                         const val = Number(item[key]);
                         newItem[newKey] = isNaN(val) ? 0 : val;
                    } else if (newKey === 'FILIAL') {
                         newItem[newKey] = String(item[key]);
                    } else {
                         newItem[newKey] = item[key];
                    }
                } else {
                     newItem[newKey] = item[key];
                }
            }
            return newItem;
        });
    }

    async function carregarDadosDoSupabase(supabaseClient) {
        isAppReady = true;
        const loader = document.getElementById('loader');
        const loaderText = document.getElementById('loader-text');
        const dashboardView = document.getElementById('main-dashboard'); // ID no novo template Ã© main-dashboard? Check template.
        // Template wrapper id is 'content-wrapper', inside is 'main-dashboard'

        try {
            loader.classList.remove('hidden');
            loaderText.textContent = 'Buscando dados...';

            // Shared client map for both parsers
            const clientMap = {
                'CODIGO_CLIENTE': 'CÃ³digo',
                'RCA1': 'RCA 1',
                'RCA2': 'RCA 2',
                'NOMECLIENTE': 'Cliente',
                'RAZAOSOCIAL': 'Cliente',
                'ULTIMACOMPRA': 'Data da Ãšltima Compra',
                'DATACADASTRO': 'Data e Hora de Cadastro',
                'INSCRICAOESTADUAL': 'Insc. Est. / Produtor',
                'CNPJ_CPF': 'CNPJ/CPF',
                'ENDERECO': 'EndereÃ§o Comercial',
                'TELEFONE': 'Telefone Comercial',
                'RCAS': 'rcas'
            };

            const parseCSVToObjects = (text, type) => {
                const result = [];
                let headers = null;
                let currentVal = '';
                let currentLine = [];
                let inQuote = false;

                const pushLine = (lineValues) => {
                    if (!headers) {
                        headers = lineValues;
                        return;
                    }
                    if (lineValues.length !== headers.length) return;

                    const obj = {};
                    for (let j = 0; j < headers.length; j++) {
                        let header = headers[j].trim().toUpperCase();
                        let val = lineValues[j];

                        if (type === 'clients' && clientMap[header]) header = clientMap[header];
                        if (type === 'orders' && ['VLVENDA', 'TOTPESOLIQ', 'VLBONIFIC', 'QTVENDA'].includes(header)) val = val === '' ? 0 : Number(val);

                        obj[header] = val;
                    }
                    result.push(obj);
                };

                for (let i = 0; i < text.length; i++) {
                    const char = text[i];
                    if (inQuote) {
                        if (char === '"') {
                            if (i + 1 < text.length && text[i + 1] === '"') { currentVal += '"'; i++; }
                            else { inQuote = false; }
                        } else { currentVal += char; }
                    } else {
                        if (char === '"') { inQuote = true; }
                        else if (char === ',') { currentLine.push(currentVal); currentVal = ''; }
                        else if (char === '\n' || char === '\r') {
                            if (char === '\r' && i + 1 < text.length && text[i+1] === '\n') i++;
                            currentLine.push(currentVal); currentVal = '';
                            pushLine(currentLine); currentLine = [];
                        } else { currentVal += char; }
                    }
                }
                if (currentLine.length > 0 || currentVal !== '') { currentLine.push(currentVal); pushLine(currentLine); }
                return result;
            };

            const parseCSVToColumnar = (text, type, existingColumnar = null) => {
                const columnar = existingColumnar || { columns: [], values: {}, length: 0 };
                let headers = columnar.columns.length > 0 ? columnar.columns : null;
                let currentVal = '';
                let currentLine = [];
                let inQuote = false;
                let isHeader = !headers;

                const pushLine = (lineValues) => {
                    if (lineValues.length === 0 || (lineValues.length === 1 && lineValues[0] === '')) return;

                    if (isHeader) {
                        headers = lineValues.map(h => {
                            let header = h.trim().toUpperCase();
                            if (type === 'clients' && clientMap[header]) header = clientMap[header];
                            return header;
                        });
                        columnar.columns = headers;
                        headers.forEach(h => { if (!columnar.values[h]) columnar.values[h] = []; });
                        isHeader = false;
                        return;
                    }

                    if (headers && lineValues.length === headers.length) {
                        for (let j = 0; j < headers.length; j++) {
                            const header = headers[j];
                            let val = lineValues[j];

                            if (type === 'sales' || type === 'history') {
                                if (['QTVENDA', 'VLVENDA', 'VLBONIFIC', 'TOTPESOLIQ', 'ESTOQUECX', 'ESTOQUEUNIT', 'QTVENDA_EMBALAGEM_MASTER', 'PEDIDO'].includes(header)) {
                                    val = val === '' ? 0 : Number(val);
                                }
                            }
                            if (type === 'stock' && header === 'STOCK_QTY') val = val === '' ? 0 : Number(val);
                            if (type === 'clients' && header === 'rcas') {
                                if (typeof val === 'string') {
                                    val = val.trim();
                                    if (val.startsWith('{')) {
                                        val = val.slice(1, -1).split(',').map(s => s.replace(/^"|"$/g, ''));
                                    } else if (val.startsWith('[')) {
                                        try { val = JSON.parse(val); } catch(e) { val = [val]; }
                                    } else if (val === '') {
                                        val = [];
                                    } else {
                                        val = [val];
                                    }
                                } else if (!val) {
                                    val = [];
                                } else if (!Array.isArray(val)) {
                                    val = [val];
                                }
                            }

                            columnar.values[header].push(val);
                        }
                        columnar.length++;
                    }
                };

                for (let i = 0; i < text.length; i++) {
                    const char = text[i];
                    if (inQuote) {
                        if (char === '"') {
                            if (i + 1 < text.length && text[i + 1] === '"') { currentVal += '"'; i++; }
                            else { inQuote = false; }
                        } else { currentVal += char; }
                    } else {
                        if (char === '"') { inQuote = true; }
                        else if (char === ',') { currentLine.push(currentVal); currentVal = ''; }
                        else if (char === '\n' || char === '\r') {
                            if (char === '\r' && i + 1 < text.length && text[i+1] === '\n') i++;
                            currentLine.push(currentVal); currentVal = '';
                            pushLine(currentLine); currentLine = [];
                        } else { currentVal += char; }
                    }
                }
                if (currentLine.length > 0 || currentVal !== '') { currentLine.push(currentVal); pushLine(currentLine); }
                return columnar;
            };

            const fetchAll = async (table, columns = null, type = null, format = 'object') => {
                let result = format === 'columnar' ? null : [];
                let page = 0;
                let pageSize = 2000;

                while(true) {
                    let query = supabaseClient.from(table).select(columns || '*', { count: 'exact', head: false });

                    if (columns) {
                        // Fetch CSV
                        const { data, error } = await query.range(page*pageSize, (page+1)*pageSize-1).csv();
                        if (error) throw error;
                        if (!data || data.length === 0) break;

                        if (format === 'columnar') {
                            result = parseCSVToColumnar(data, type, result);
                        } else {
                            const objects = parseCSVToObjects(data, type);
                            result = result.concat(objects);
                        }

                        const newlines = (data.match(/\n/g) || []).length;
                        if (newlines < pageSize && data.length > 0) break;
                    } else {
                        // Fetch JSON (standard)
                        const { data, error } = await query.range(page*pageSize, (page+1)*pageSize-1);
                        if (error) throw error;
                        if (!data || data.length === 0) break;
                        result = result.concat(data);
                        if (data.length < pageSize) break;
                    }
                    page++;
                }
                return result;
            };

            const colsDetailed = 'pedido,codcli,nome,superv,codsupervisor,produto,descricao,fornecedor,observacaofor,codfor,codusur,qtvenda,vlvenda,vlbonific,totpesoliq,dtped,dtsaida,posicao,estoqueunit,tipovenda,filial,qtvenda_embalagem_master';
            const colsClients = 'codigo_cliente,rca1,rca2,rcas,cidade,nomecliente,bairro,razaosocial,fantasia,cnpj_cpf,endereco,numero,cep,telefone,email,ramo,ultimacompra,datacadastro,bloqueio,inscricaoestadual';
            const colsStock = 'product_code,filial,stock_qty';
            const colsOrders = 'pedido,codcli,cliente_nome,cidade,nome,superv,fornecedores_str,dtped,dtsaida,posicao,vlvenda,totpesoliq,filial';

            const [detailedUpper, historyUpper, clientsUpper, products, activeProds, stock, innovations, metadata, ordersUpper] = await Promise.all([
                fetchAll('data_detailed', colsDetailed, 'sales', 'columnar'),
                fetchAll('data_history', colsDetailed, 'history', 'columnar'),
                fetchAll('data_clients', colsClients, 'clients', 'columnar'),
                fetchAll('data_product_details'),
                fetchAll('data_active_products'),
                fetchAll('data_stock', colsStock, 'stock', 'columnar'),
                fetchAll('data_innovations'),
                fetchAll('data_metadata'),
                fetchAll('data_orders', colsOrders, 'orders', 'object') // Keep orders as objects for renderTable
            ]);

            loaderText.textContent = 'Processando...';

            const detailed = detailedUpper;
            const history = historyUpper;
            const clients = clientsUpper;
            const orders = ordersUpper;

            // Reconstruct Helper Maps
            const productDetailsMap = {};
            if (products && products.length) {
                products.forEach(p => {
                    productDetailsMap[p.code] = {
                        descricao: p.descricao,
                        fornecedor: p.fornecedor,
                        codfor: p.codfor,
                        dtCadastro: p.dtcadastro ? new Date(p.dtcadastro).getTime() : null,
                        ...p
                    };
                });
            }

            const activeProductCodes = activeProds.map(p => p.code);

            const stockMap05 = {};
            const stockMap08 = {};
            if (stock && stock.values) {
                const pCodes = stock.values['PRODUCT_CODE'];
                const filials = stock.values['FILIAL'];
                const qtys = stock.values['STOCK_QTY'];
                const len = stock.length;
                for(let i = 0; i < len; i++) {
                    const code = pCodes[i];
                    const fil = filials[i];
                    const qty = qtys[i];
                    if (fil === '05') stockMap05[code] = qty;
                    if (fil === '08') stockMap08[code] = qty;
                }
            }

            // Calculate Last Sale Date (Columnar optimized)
            let lastSale = 0;
            if (detailedUpper.values && detailedUpper.values['DTPED']) {
                const dtpeds = detailedUpper.values['DTPED'];
                const len = dtpeds.length;
                for(let i=0; i<len; i++) {
                    if (dtpeds[i] > lastSale) lastSale = dtpeds[i];
                }
            } else if (Array.isArray(detailedUpper) && detailedUpper.length > 0) {
                 lastSale = detailedUpper.reduce((max, p) => p.DTPED > max ? p.DTPED : max, 0);
            }
            if (lastSale === 0) lastSale = Date.now();

            const embeddedData = {
                detailed: detailedUpper,
                history: historyUpper,
                clients: clientsUpper,
                byOrder: ordersUpper,
                stockMap05: stockMap05,
                stockMap08: stockMap08,
                innovationsMonth: innovations,
                activeProductCodes: activeProductCodes,
                productDetails: productDetailsMap,
                metadata: metadata,
                passedWorkingDaysCurrentMonth: 1,
                isColumnar: true
            };

            // Update Generation Date UI
            const lastUpdateText = document.getElementById('last-update-text');
            if (lastUpdateText) {
                const dateObj = new Date(lastSale);
                const formattedDate = dateObj.toLocaleDateString('pt-BR');
                lastUpdateText.textContent = `Dados atualizados em: ${formattedDate}`;
            }

            window.embeddedData = embeddedData;
            window.isDataLoaded = true;

            // Inject Logic
            const scriptLogicContent = document.getElementById('report-logic-script').textContent;
            // We need to execute it. Since it declares variables with 'let'/'const' in global scope,
            // we should be careful. The extracted script assumes global scope.
            // We can use eval or append script tag.

            const scriptEl = document.createElement('script');
            scriptEl.textContent = scriptLogicContent;
            document.body.appendChild(scriptEl);

            // Trigger init if needed, but the script usually auto-runs or adds event listeners
            // The extracted script has `document.addEventListener('DOMContentLoaded'...)` inside?
            // No, it usually runs `initializeOptimizedDataStructures();` at the end.

            loader.classList.add('hidden');
            document.getElementById('content-wrapper').classList.remove('hidden');

        } catch (e) {
            console.error(e);
            loaderText.textContent = 'Erro: ' + e.message;
        }
    }
</script>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const { createClient } = supabase;
        const supabaseClient = window.supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Gatekeeper Logic
        const loginButton = document.getElementById('login-button');
        const telaLogin = document.getElementById('tela-login');
        const telaLoading = document.getElementById('tela-loading');
        const telaPendente = document.getElementById('tela-pendente');

        // Logout Button Logic for Pending Screen
        const logoutButtonPendente = document.getElementById('logout-button-pendente');
        if (logoutButtonPendente) {
            logoutButtonPendente.addEventListener('click', async () => {
                const { error } = await supabaseClient.auth.signOut();
                if (error) console.error('Erro ao sair:', error);
                window.location.reload();
            });
        }

        loginButton.addEventListener('click', async () => {
            await supabaseClient.auth.signInWithOAuth({
                provider: 'google',
                options: { redirectTo: window.location.origin + window.location.pathname }
            });
        });

        let isCheckingProfile = false;
        let isAppReady = false;

        async function verifyUserProfile(session) {
            if (window.isDataLoaded) {
                const telaLoading = document.getElementById('tela-loading');
                const telaLogin = document.getElementById('tela-login');
                if (telaLoading) telaLoading.classList.add('hidden');
                if (telaLogin) telaLogin.classList.add('hidden');
                return;
            }

            if (isCheckingProfile || !session) return;
            isCheckingProfile = true;

            // Only Reset UI to Loading State if App is NOT Ready (Initial Load)
            if (!isAppReady) {
                telaLogin.classList.add('hidden');
                telaPendente.classList.add('hidden');
                const card = document.getElementById('loading-card-content');
                if (card) {
                    card.innerHTML = `
                        <h2 style="margin-top: 0; font-size: 1.5rem; font-weight: 600;">Carregando...</h2>
                        <p style="color: #a0aec0;">Verificando credenciais.</p>
                        <p style="color: #4a5568; font-size: 0.75rem; margin-top: 1rem;">v5.2.1</p>
                    `;
                }
                telaLoading.classList.remove('hidden');
            }

            try {
                // Check Profile with Timeout - 15s
                const timeout = new Promise((_, reject) => setTimeout(() => reject(new Error('Tempo limite de conexÃ£o excedido. Verifique sua internet.')), 15000));
                const profilePromise = supabaseClient.from('profiles').select('*').eq('id', session.user.id).single();

                const { data: profile, error } = await Promise.race([profilePromise, timeout]);

                if (error) {
                    if (error.code !== 'PGRST116') {
                        throw error;
                    }
                }

                if (profile && profile.status === 'aprovado') {
                    if (!isAppReady) {
                        telaLoading.classList.add('hidden');
                        carregarDadosDoSupabase(supabaseClient);
                    }
                    // If App is Ready, we do nothing - keep dashboard active.
                } else {
                    // Profile not approved - Enforce Block
                    telaLoading.classList.add('hidden');
                    telaPendente.classList.remove('hidden');
                    // Hide dashboard content just in case
                    const contentWrapper = document.getElementById('content-wrapper');
                    if(contentWrapper) contentWrapper.classList.add('hidden');
                }
            } catch (err) {
                console.error("Error checking profile:", err);

                // If App is Ready (Silent Check), suppress error screen.
                if (isAppReady) {
                    console.warn("Background profile check failed. Keeping session active.");
                    // Optionally show a toast here in future.
                } else {
                    // Initial Load Failed - Show Error Screen
                    const card = document.getElementById('loading-card-content');
                    if (card) {
                        card.innerHTML = `
                            <h2 style="margin-top: 0; font-size: 1.5rem; font-weight: 600; color: #fc8181;">Erro de ConexÃ£o</h2>
                            <p style="color: #a0aec0; margin-bottom: 1.5rem;">${err.message || 'NÃ£o foi possÃ­vel verificar suas credenciais.'}</p>
                            <button id="retry-connection-btn" class="gatekeeper-btn" style="background-color: #2d3748; border-color: #4a5568;">
                                Tentar Novamente
                            </button>
                            <p style="color: #4a5568; font-size: 0.75rem; margin-top: 1rem;">v5.2.1</p>
                        `;
                        // Re-bind retry button
                        const retryBtn = document.getElementById('retry-connection-btn');
                        if(retryBtn) {
                            retryBtn.addEventListener('click', () => {
                                isCheckingProfile = false; // Reset flag to allow retry
                                verifyUserProfile(session);
                            });
                        }
                    } else {
                        alert("Erro de conexÃ£o: " + err.message);
                        telaLoading.classList.add('hidden');
                        telaPendente.classList.remove('hidden');
                    }
                }
            } finally {
                isCheckingProfile = false;
            }
        }

        // Visibility Change Listener for Reconnection
        document.addEventListener('visibilitychange', async () => {
            if (document.visibilityState === 'visible') {
                const errorCard = document.getElementById('loading-card-content');
                // Check if we are showing the connection error screen
                if (errorCard && errorCard.innerHTML.includes('Erro de ConexÃ£o')) {
                    console.log('Tab became visible and error screen detected. Attempting seamless reconnection...');

                    const { data } = await supabaseClient.auth.getSession();
                    if (data && data.session) {
                        // Force retry without reload
                        isCheckingProfile = false; // Reset flag to allow auto-retry
                        verifyUserProfile(data.session);
                    } else {
                        // No session? Reload to login
                        window.location.reload();
                    }
                }
            }
        });

        // Auth State Listener
        supabaseClient.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                verifyUserProfile(session);
            } else {
                telaLogin.classList.remove('hidden');
            }
        });


        // Theme Switcher Logic
        const themeCheckbox = document.getElementById('checkbox-theme');
        const htmlElement = document.documentElement;

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        if (savedTheme === 'light') {
            htmlElement.classList.add('light');
            if(themeCheckbox) themeCheckbox.checked = true;
        }

        if(themeCheckbox) {
            themeCheckbox.addEventListener('change', function() {
                if(this.checked) {
                    htmlElement.classList.add('light');
                    localStorage.setItem('theme', 'light');
                } else {
                    htmlElement.classList.remove('light');
                    localStorage.setItem('theme', 'dark');
                }

                // Force Chart.js update if charts exist (optional but good practice)
                if (typeof charts !== 'undefined') {
                    // Trigger a re-render or reload if necessary for charts to pick up colors
                    // For now, just CSS variables handle most UI
                }
            });
        }


        // Admin Modal Logic
        const adminBtn = document.getElementById('open-admin-btn');
        const adminModal = document.getElementById('admin-uploader-modal');
        if (adminBtn && adminModal) {
            adminBtn.addEventListener('click', () => {
                adminModal.classList.remove('hidden');
                // Close sidebar on mobile if open
                document.getElementById('side-menu').classList.remove('translate-x-0');
                document.getElementById('sidebar-overlay').classList.add('hidden');
            });
        }

        // Save Goals Logic
        const saveBtn = document.getElementById('save-goals-btn');
        const clearBtn = document.getElementById('clear-goals-btn');
        const masterKeyModal = document.getElementById('master-key-modal');
        const masterKeyInput = document.getElementById('master-key-input');
        const masterKeyConfirm = document.getElementById('master-key-confirm');
        const masterKeyCancel = document.getElementById('master-key-cancel');

        // State to know if we are saving or clearing
        let pendingAction = null; // 'save' or 'clear'

        if (saveBtn) {
            saveBtn.addEventListener('click', () => {
                pendingAction = 'save';
                masterKeyModal.classList.remove('hidden');
            });
        }

        if (clearBtn) {
            clearBtn.addEventListener('click', () => {
                pendingAction = 'clear';
                masterKeyModal.classList.remove('hidden');
            });
        }

        masterKeyCancel.addEventListener('click', () => {
            masterKeyModal.classList.add('hidden');
            masterKeyInput.value = '';
        });

        masterKeyConfirm.addEventListener('click', async () => {
            const keyInput = masterKeyInput.value.trim();

            // Tentamos obter a sessÃ£o atual do usuÃ¡rio
            const { data: { session } } = await supabaseClient.auth.getSession();

            // Prioridade: Chave fornecida manualmente (pode ser a service_role) OU Token da sessÃ£o
            const authToken = keyInput || session?.access_token;

            if (!authToken) {
                alert('Por favor, faÃ§a login ou insira a Chave Secreta (service_role).');
                return;
            }

            // ValidaÃ§Ã£o bÃ¡sica da chave se fornecida
            if (keyInput) {
                if (keyInput.startsWith('sb_publishable')) {
                    alert("VocÃª inseriu a chave PÃšBLICA (sb_publishable). Esta chave nÃ£o tem permissÃ£o de escrita. Por favor, insira a chave SECRETA (service_role) que comeÃ§a com 'ey...'.");
                    return;
                }
            }

            masterKeyModal.classList.add('hidden');
            masterKeyInput.value = '';

            // Dispatch based on pendingAction
            if (pendingAction === 'save') {
                const statusText = document.getElementById('save-goals-btn');
                const originalText = statusText.innerHTML;
                statusText.disabled = true;
                statusText.innerHTML = 'Salvando...';

                try {
                    await saveGoalsToSupabase(authToken);
                } catch (error) {
                    console.error(error);
                    alert('Erro ao salvar metas: ' + error.message);
                } finally {
                    statusText.disabled = false;
                    statusText.innerHTML = originalText;
                }
            } else if (pendingAction === 'clear') {
                // Call clearGoalsFromSupabase
                // Note: clearGoalsFromSupabase handles its own button state
                try {
                    await clearGoalsFromSupabase(authToken);
                } catch (error) {
                    console.error(error);
                    alert('Erro ao limpar metas: ' + error.message);
                }
            }

            pendingAction = null;
        });

        async function saveGoalsToSupabase(authToken) {
            // Collect Goals Data
            if (typeof globalClientGoals === 'undefined') {
                throw new Error('Dados de metas nÃ£o disponÃ­veis (globalClientGoals undefined).');
            }

            const monthKey = new Date().toISOString().slice(0, 7); // YYYY-MM

            // Convert Map to JSON-friendly format
            const goalsObj = {};
            globalClientGoals.forEach((val, key) => {
                goalsObj[key] = Object.fromEntries(val);
            });

            const payload = {
                month_key: monthKey,
                supplier: 'ALL', // Global snapshot
                brand: 'GENERAL', // Fix for Unique Constraint
                goals_data: {
                    clients: goalsObj,
                    targets: goalsTargets
                },
                updated_at: new Date().toISOString()
            };

            // Use FETCH directly to allow service_role key without "Forbidden" error in browser
            const response = await fetch(`${SUPABASE_URL}/rest/v1/goals_distribution`, {
                method: 'POST',
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'resolution=merge-duplicates' // upsert behavior
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Erro Supabase (${response.status}): ${errorText}`);
            }

            alert('Metas salvas com sucesso!');
        }

        async function clearGoalsFromSupabase(authToken) {
            const btn = document.getElementById('clear-goals-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Limpando...';
            btn.disabled = true;

            const monthKey = new Date().toISOString().slice(0, 7);

            try {
                // DELETE via REST
                const response = await fetch(`${SUPABASE_URL}/rest/v1/goals_distribution?month_key=eq.${monthKey}&supplier=eq.ALL&brand=eq.GENERAL`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erro ao limpar metas (${response.status}): ${errorText}`);
                }

                // Limpar estado local
                if(typeof globalClientGoals !== 'undefined') globalClientGoals.clear();
                if(typeof goalsTargets !== 'undefined') {
                    for(let k in goalsTargets) goalsTargets[k] = { fat: 0, vol: 0 };
                }

                // Atualizar UI Input fields
                const elFat = document.getElementById('goal-global-fat');
                const elVol = document.getElementById('goal-global-vol');
                const elMix = document.getElementById('goal-global-mix');
                const elMixSalty = document.getElementById('goal-global-mix-salty');
                const elMixFoods = document.getElementById('goal-global-mix-foods');

                if(elFat) elFat.value = '0,00';
                if(elVol) elVol.value = '0,000';
                if(elMix) elMix.value = '0';
                if(elMixSalty) elMixSalty.value = '0';
                if(elMixFoods) elMixFoods.value = '0';

                // Re-calcular mÃ©tricas e atualizar tabela (que usarÃ¡ os defaults ou zero)
                // Precisamos chamar updateGoals(), mas ele estÃ¡ dentro do scopo do module script principal
                // ou acessÃ­vel via window se exposto.
                // VERIFICAÃ‡ÃƒO: updateGoals estÃ¡ definido dentro do scopo 'DOMContentLoaded'.
                // Precisamos expor ou disparar um evento.
                // Vou disparar um evento customizado 'goalsCleared' e ouvir no scopo principal.
                document.dispatchEvent(new CustomEvent('goalsCleared'));

                alert('Metas limpas com sucesso!');
            } catch (err) {
                console.error('Erro ao limpar metas:', err);
                alert('Erro ao limpar metas: ' + err.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // Attach listener for Clear Button - This needs to be inside the DOMContentLoaded where authentication happens or keys are available
        // But `clearGoalsFromSupabase` needs access to URL/KEY.
        // Wait, `saveGoalsToSupabase` uses `SUPABASE_URL` which is defined in the script scope above.
        // I will hook the button click in the authentication handler block (where save-goals-btn is handled).
    });
</script>

<script id="report-logic-script" type="text/template">
        const embeddedData = window.embeddedData;

        // --- OPTIMIZATION: Lazy Columnar Accessor with Write-Back Support ---
        class ColumnarDataset {
            constructor(columnarData) {
                this.columns = columnarData.columns;
                this.values = columnarData.values;
                this.length = columnarData.length;
                this._overrides = new Map(); // Stores mutations: Map<index, Object>
            }

            get(index) {
                if (index < 0 || index >= this.length) return undefined;

                const overrides = this._overrides;
                const values = this.values;
                const columns = this.columns;

                // Return a Lazy Proxy that constructs properties only on access
                // and supports write-back for mutations (e.g. seller remapping)
                return new Proxy({}, {
                    get(target, prop) {
                        if (prop === 'toJSON') return () => "ColumnarRowProxy"; // Debug help

                        // 1. Check overrides first (mutations)
                        const ov = overrides.get(index);
                        if (ov && prop in ov) {
                            return ov[prop];
                        }

                        // 2. Check columnar data (lazy read)
                        // Note: values[prop] is the array for that column
                        if (values && values[prop]) {
                            return values[prop][index];
                        }

                        return target[prop]; // Fallback (e.g. prototype methods)
                    },

                    set(target, prop, value) {
                        let ov = overrides.get(index);
                        if (!ov) {
                            ov = {};
                            overrides.set(index, ov);
                        }
                        ov[prop] = value;
                        return true;
                    },

                    ownKeys(target) {
                        // Return all original columns plus any new keys added via mutation
                        const ov = overrides.get(index);
                        if (ov) {
                            // Create a set of keys to ensure uniqueness
                            const keys = new Set(columns);
                            Object.keys(ov).forEach(k => keys.add(k));
                            return Array.from(keys);
                        }
                        return columns;
                    },

                    getOwnPropertyDescriptor(target, prop) {
                        // Check overrides or values to confirm existence
                        const ov = overrides.get(index);
                        if ((ov && prop in ov) || (values && values[prop])) {
                            return { enumerable: true, configurable: true, writable: true };
                        }
                        return undefined;
                    },

                    has(target, prop) {
                        const ov = overrides.get(index);
                        return (ov && prop in ov) || (values && prop in values);
                    }
                });
            }

            // Implement basic Array methods to behave like an array
            map(callback) {
                const result = new Array(this.length);
                for (let i = 0; i < this.length; i++) {
                    result[i] = callback(this.get(i), i, this);
                }
                return result;
            }

            filter(callback) {
                const result = [];
                for (let i = 0; i < this.length; i++) {
                    const item = this.get(i);
                    if (callback(item, i, this)) {
                        result.push(item);
                    }
                }
                return result;
            }

            forEach(callback) {
                for (let i = 0; i < this.length; i++) {
                    callback(this.get(i), i, this);
                }
            }

            reduce(callback, initialValue) {
                let accumulator = initialValue;
                for (let i = 0; i < this.length; i++) {
                    if (i === 0 && initialValue === undefined) {
                        accumulator = this.get(i);
                    } else {
                        accumulator = callback(accumulator, this.get(i), i, this);
                    }
                }
                return accumulator;
            }

            map(callback) {
                const result = new Array(this.length);
                for (let i = 0; i < this.length; i++) {
                    result[i] = callback(this.get(i), i);
                }
                return result;
            }

            filter(callback) {
                const result = [];
                for (let i = 0; i < this.length; i++) {
                    const item = this.get(i);
                    if (callback(item, i)) result.push(item);
                }
                return result;
            }

            reduce(callback, initialValue) {
                let accumulator = initialValue;
                for (let i = 0; i < this.length; i++) {
                    accumulator = callback(accumulator, this.get(i), i);
                }
                return accumulator;
            }

            some(callback) {
                for (let i = 0; i < this.length; i++) {
                    if (callback(this.get(i), i)) return true;
                }
                return false;
            }

            every(callback) {
                for (let i = 0; i < this.length; i++) {
                    if (!callback(this.get(i), i)) return false;
                }
                return true;
            }

            find(callback) {
                for (let i = 0; i < this.length; i++) {
                    const item = this.get(i);
                    if (callback(item, i)) return item;
                }
                return undefined;
            }

            [Symbol.iterator]() {
                let index = 0;
                return {
                    next: () => {
                        if (index < this.length) {
                            return { value: this.get(index++), done: false };
                        } else {
                            return { done: true };
                        }
                    }
                };
            }
        }

        // Custom Map implementation for Index-based storage
        class IndexMap {
            constructor(dataSource) {
                this._indices = new Map();
                this._source = dataSource;
            }

            set(key, index) {
                this._indices.set(key, index);
            }

            get(key) {
                const index = this._indices.get(key);
                if (index === undefined) return undefined;
                return this._source.get(index);
            }

            getIndex(key) {
                return this._indices.get(key);
            }

            has(key) {
                return this._indices.has(key);
            }

            values() {
                // Warning: Heavy operation
                const objects = [];
                for (const index of this._indices.values()) {
                    objects.push(this._source.get(index));
                }
                return objects;
            }

            forEach(callback) {
                this._indices.forEach((index, key) => {
                    callback(this._source.get(index), key);
                });
            }
        }

        function parseDate(dateString) {
            if (!dateString) return null;

            // Se jÃ¡ for um objeto Date, retorna diretamente
            if (dateString instanceof Date) {
                return !isNaN(dateString.getTime()) ? dateString : null;
            }

            // Se for um nÃºmero (formato Excel ou Timestamp)
            if (typeof dateString === 'number') {
                // Excel Serial Date (approx < 50000 for current dates, Timestamp is > 1000000000000)
                if (dateString < 100000) return new Date(Math.round((dateString - 25569) * 86400 * 1000));
                // Timestamp
                return new Date(dateString);
            }

            if (typeof dateString !== 'string') return null;

            // Tentativa de parse para 'YYYY-MM-DDTHH:mm:ss.sssZ' ou 'YYYY-MM-DD'
            // O construtor do Date jÃ¡ lida bem com isso, mas vamos garantir o UTC.
            if (dateString.includes('T') || dateString.includes('-')) {
                 // Adiciona 'Z' se nÃ£o tiver informaÃ§Ã£o de fuso horÃ¡rio para forÃ§ar UTC
                const isoString = dateString.endsWith('Z') ? dateString : dateString + 'Z';
                const isoDate = new Date(isoString);
                if (!isNaN(isoDate.getTime())) {
                    return isoDate;
                }
            }

            // Tentativa de parse para 'DD/MM/YYYY'
            if (dateString.length === 10 && dateString.charAt(2) === '/' && dateString.charAt(5) === '/') {
                const [day, month, year] = dateString.split('/');
                if (year && month && day && year.length === 4) {
                    // Cria a data em UTC para evitar problemas de fuso horÃ¡rio
                    const utcDate = new Date(Date.UTC(parseInt(year), parseInt(month) - 1, parseInt(day)));
                    if (!isNaN(utcDate.getTime())) {
                        return utcDate;
                    }
                }
            }

            // Fallback para outros formatos que o `new Date()` consegue interpretar
            const genericDate = new Date(dateString);
            if (!isNaN(genericDate.getTime())) {
                return genericDate;
            }

            return null; // Retorna nulo se nenhum formato corresponder
        }

        // --- OPTIMIZATION: Chunked Processor to prevent UI Freeze ---
        function runAsyncChunked(items, processItemFn, onComplete, isCancelled) {
            let index = 0;
            const total = items.length;

            // Check if items is a ColumnarDataset and access by index directly to avoid overhead
            const isColumnar = items instanceof ColumnarDataset;

            function nextChunk() {
                if (isCancelled && isCancelled()) return;

                const start = performance.now();
                while (index < total && performance.now() - start < 12) { // 12ms budget per frame (60fps target is 16ms)
                    const item = isColumnar ? items.get(index) : items[index];
                    processItemFn(item, index);
                    index++;
                }

                if (index < total) {
                    setTimeout(nextChunk, 0); // Yield to main thread
                } else {
                    if(onComplete) onComplete();
                }
            }

            nextChunk();
        }

        const FORBIDDEN_KEYS = ['SUPERV', 'CODUSUR', 'CODSUPERVISOR', 'NOME', 'CODCLI', 'PRODUTO', 'DESCRICAO', 'FORNECEDOR', 'OBSERVACAOFOR', 'CODFOR', 'QTVENDA', 'VLVENDA', 'VLBONIFIC', 'TOTPESOLIQ', 'ESTOQUEUNIT', 'TIPOVENDA', 'FILIAL', 'ESTOQUECX', 'SUPERVISOR', 'PASTA', 'RAMO', 'ATIVIDADE', 'CIDADE', 'MUNICIPIO', 'BAIRRO'];
        let allSalesData, allHistoryData, allClientsData;

        function sanitizeData(data) {
            if (!data) return [];
            const forbidden = ['SUPERV', 'CODUSUR', 'CODSUPERVISOR', 'NOME', 'CODCLI', 'PRODUTO', 'DESCRICAO', 'FORNECEDOR', 'OBSERVACAOFOR', 'CODFOR', 'QTVENDA', 'VLVENDA', 'VLBONIFIC', 'TOTPESOLIQ', 'ESTOQUEUNIT', 'TIPOVENDA', 'FILIAL', 'ESTOQUECX', 'SUPERVISOR'];

            // Check if it's a ColumnarDataset proxy or regular array.
            // If it's a ColumnarDataset, we can't easily filter in-place without rebuilding.
            // However, ColumnarDataset usually proxies access.
            // Since we're trying to fix garbage, it's safer to check if we can filter.

            if (Array.isArray(data)) {
                return data.filter(item => {
                    const superv = String(item.SUPERV || '').trim().toUpperCase();
                    const nome = String(item.NOME || '').trim().toUpperCase();
                    const codUsur = String(item.CODUSUR || '').trim().toUpperCase();
                    // Check against headers
                    if (forbidden.includes(superv) || forbidden.includes(nome) || forbidden.includes(codUsur)) return false;
                    return true;
                });
            }
            // If Columnar, we assume the worker already did a good job, OR we might need to implement filtering for ColumnarDataset.
            // But since 'fromColumnar' was removed/replaced by 'ColumnarDataset' class usage?
            // Wait, looking at the code above: 'allSalesData = new ColumnarDataset(...)'.
            // Filtering a ColumnarDataset is hard.
            // But wait! The worker ALREADY sanitizes via 'processSalesData' logic I added.

            return data;
        }

        if (embeddedData.isColumnar) {
            allSalesData = new ColumnarDataset(embeddedData.detailed);
            allHistoryData = new ColumnarDataset(embeddedData.history);
            allClientsData = new ColumnarDataset(embeddedData.clients);
        } else {
            allSalesData = sanitizeData(embeddedData.detailed);
            allHistoryData = sanitizeData(embeddedData.history);
            allClientsData = embeddedData.clients;
        }

        let aggregatedOrders = embeddedData.byOrder;
        const stockData05 = new Map(Object.entries(embeddedData.stockMap05 || {}));
        const stockData08 = new Map(Object.entries(embeddedData.stockMap08 || {}));
        const innovationsMonthData = embeddedData.innovationsMonth;
        const clientMapForKPIs = new Map();
        // Init Client Map manually since map() might be slower on Columnar
        for(let i=0; i<allClientsData.length; i++) {
            const c = allClientsData instanceof ColumnarDataset ? allClientsData.get(i) : allClientsData[i];
            clientMapForKPIs.set(String(c['CÃ³digo'] || c['codigo_cliente']), c);
        }

        const activeProductCodesFromCadastro = new Set(embeddedData.activeProductCodes || []);
        const productDetailsMap = new Map(Object.entries(embeddedData.productDetails || {}));
        const passedWorkingDaysCurrentMonth = embeddedData.passedWorkingDaysCurrentMonth || 1;

        const clientsWithSalesThisMonth = new Set();
        // Populate set
        for(let i=0; i<allSalesData.length; i++) {
            const s = allSalesData instanceof ColumnarDataset ? allSalesData.get(i) : allSalesData[i];
            clientsWithSalesThisMonth.add(s.CODCLI);
        }

        const optimizedData = {
            salesById: embeddedData.isColumnar ? new IndexMap(allSalesData) : new Map(),
            historyById: embeddedData.isColumnar ? new IndexMap(allHistoryData) : new Map(),
            indices: {
                current: {
                    bySupervisor: new Map(),
                    byRca: new Map(),
                    byPasta: new Map(),
                    bySupplier: new Map(),
                    byClient: new Map(),
                    byPosition: new Map(),
                    byRede: new Map(),
                    byTipoVenda: new Map(),
                    byProduct: new Map(),
                    byCity: new Map(),
                    byFilial: new Map()
                },
                history: {
                    bySupervisor: new Map(),
                    byRca: new Map(),
                    byPasta: new Map(),
                    bySupplier: new Map(),
                    byClient: new Map(),
                    byPosition: new Map(),
                    byRede: new Map(),
                    byTipoVenda: new Map(),
                    byProduct: new Map(),
                    byCity: new Map(),
                    byFilial: new Map()
                }
            },
            searchIndices: {
                clients: [], // [{ code, nameLower, cityLower }]
                products: [] // [{ code, descLower }]
            }
        };
        let clientLastBranch = new Map();
        let clientRamoMap = new Map();

        const QUARTERLY_DIVISOR = 3;

        // Optimized lastSaleDate calculation to avoid mapping huge array
        let maxDateTs = 0;
        for(let i=0; i<allSalesData.length; i++) {
            const s = allSalesData instanceof ColumnarDataset ? allSalesData.get(i) : allSalesData[i];
            const d = parseDate(s.DTPED);
            if(d && !isNaN(d)) {
                const ts = d.getTime();
                if(ts > maxDateTs) maxDateTs = ts;
            }
        }
        const lastSaleDate = maxDateTs > 0 ? new Date(maxDateTs) : new Date();
        lastSaleDate.setUTCHours(0,0,0,0);
        let maxWorkingDaysStock = 0;
        let sortedWorkingDays = [];
        let customWorkingDaysStock = 0;

        function initializeOptimizedDataStructures() {
            const sellerDetailsMap = new Map();
            const sellerLastSaleDateMap = new Map(); // Track latest date per seller
            const clientToCurrentSellerMap = new Map();
            let americanasCodCli = null;

            // Use ONLY History Data for identifying Supervisor (User Request)
            // Identify Supervisor for each Seller based on the *Latest* sale in History
            const historyData = allHistoryData; // Using variable for clarity
            for (let i = 0; i < historyData.length; i++) {
                const s = historyData instanceof ColumnarDataset ? historyData.get(i) : historyData[i];
                const codUsur = s.CODUSUR;
                // Ignorar 'INATIVOS' e 'AMERICANAS' para evitar poluiÃ§Ã£o do mapa de supervisores com lÃ³gica de fallback
                if (codUsur && s.NOME !== 'INATIVOS' && s.NOME !== 'AMERICANAS') {
                    const dt = parseDate(s.DTPED);
                    const ts = dt ? dt.getTime() : 0;
                    const lastTs = sellerLastSaleDateMap.get(codUsur) || 0;

                    if (ts >= lastTs || !sellerDetailsMap.has(codUsur)) {
                        sellerLastSaleDateMap.set(codUsur, ts);
                        sellerDetailsMap.set(codUsur, { name: s.NOME, supervisor: s.SUPERV });
                    }
                }
            }

            optimizedData.clientsByRca = new Map();
            optimizedData.searchIndices.clients = new Array(allClientsData.length);

            // Access via accessor method for potential ColumnarDataset
            const getClient = (i) => allClientsData instanceof ColumnarDataset ? allClientsData.get(i) : allClientsData[i];

            for (let i = 0; i < allClientsData.length; i++) {
                const client = getClient(i); // Hydrate object for processing
                const codCli = String(client['CÃ³digo'] || client['codigo_cliente']);

                // Normalize keys from Supabase (Upper) or Local/Legacy (Lower/Camel)
                // mapKeysToUpper might have transformed 'cidade' -> 'CIDADE', 'ramo' -> 'RAMO', etc.
                client.cidade = client.cidade || client.CIDADE || 'N/A';
                client.bairro = client.bairro || client.BAIRRO || 'N/A';
                client.ramo = client.ramo || client.RAMO || 'N/A';

                // Name Normalization
                // mapKeysToUpper maps 'NOMECLIENTE' -> 'Cliente'. Local/Worker might produce 'nomeCliente'.
                client.nomeCliente = client.nomeCliente || client.Cliente || client.CLIENTE || client.NOMECLIENTE || 'N/A';

                // RCA Handling
                // mapKeysToUpper maps 'RCA1' -> 'RCA 1'. Local might use 'rca1'.
                const rca1 = client.rca1 || client['RCA 1'] || client.RCA1;
                // Normalize access for rest of the code
                client.rca1 = rca1;

                const razaoSocial = client.razaoSocial || client.RAZAOSOCIAL || client.Cliente || ''; // Fallback

                if (razaoSocial.toUpperCase().includes('AMERICANAS')) {
                    client.rca1 = '1001';
                    client.rcas = ['1001'];
                    americanasCodCli = codCli;
                }
                // Removed INATIVOS logic as per request

                if (client.rca1) clientToCurrentSellerMap.set(codCli, String(client.rca1));
                clientRamoMap.set(codCli, client.ramo);

                // Handle RCAS array (could be 'rcas' or 'RCAS')
                const rcas = client.rcas || client.RCAS;
                client.rcas = rcas; // Normalize for later use if needed

                if (rcas) {
                    for (let j = 0; j < rcas.length; j++) {
                        const rca = rcas[j];
                        if (rca) {
                            if (!optimizedData.clientsByRca.has(rca)) optimizedData.clientsByRca.set(rca, []);
                            optimizedData.clientsByRca.get(rca).push(client);
                        }
                    }
                }

                optimizedData.searchIndices.clients[i] = { code: codCli, nameLower: (client.nomeCliente || '').toLowerCase(), cityLower: (client.cidade || '').toLowerCase() };
            }

            optimizedData.rcasBySupervisor = new Map();
            optimizedData.productsBySupplier = new Map();
            optimizedData.salesByProduct = { current: new Map(), history: new Map() };
            optimizedData.rcaCodeByName = new Map();
            optimizedData.rcaNameByCode = new Map();
            optimizedData.supervisorCodeByName = new Map();
            optimizedData.productPastaMap = new Map();
            const supervisorToRcaMap = new Map();
            const workingDaysSet = new Set();

            const processDatasetForIndices = (data, indexSet, dataMap, isHistory) => {
                const { bySupervisor, byRca, byPasta, bySupplier, byClient, byPosition, byRede, byTipoVenda, byProduct, byCity, byFilial } = indexSet;

                const isColumnar = data instanceof ColumnarDataset;
                const colValues = isColumnar ? data.values : null;

                // Optimization: Helper to read values without creating Proxy
                const getVal = (i, prop) => {
                    if (isColumnar && colValues[prop]) {
                        return colValues[prop][i];
